<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KLVF2ZG1WX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KLVF2ZG1WX');
    </script>
    
    <meta charset="UTF-8">
    <title>Prokaiwa | Cancel Subscription</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="We'd hate to see you go. Let us know how we can improve.">
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        /* Cancellation Page Styles */
        .cancellation-container {
            max-width: 800px;
            margin: 3rem auto;
            padding: 2rem;
        }
        
        .cancellation-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .cancellation-header h1 {
            color: var(--color-text);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .cancellation-header p {
            color: var(--color-text-light);
            font-size: 1.1rem;
        }
        
        /* Progress Steps */
        .cancellation-steps {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            padding: 0 1rem;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            max-width: 150px;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--color-bg);
            border: 2px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--color-text-muted);
            transition: all 0.3s ease;
        }
        
        .step.active .step-circle {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
        }
        
        .step.completed .step-circle {
            background: var(--color-success);
            border-color: var(--color-success);
            color: white;
        }
        
        .step-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--color-primary);
            font-weight: 600;
        }
        
        /* Cancellation Card */
        .cancellation-card {
            background: var(--color-card-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        /* Step Sections */
        .step-section {
            display: none;
        }
        
        .step-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Reason Selection */
        .reason-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .reason-option {
            padding: 1.25rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .reason-option:hover {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
        }
        
        .reason-option.selected {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
            box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.1);
        }
        
        .reason-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }
        
        .reason-content {
            flex: 1;
        }
        
        .reason-title {
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 0.25rem;
        }
        
        .reason-subtitle {
            font-size: 0.85rem;
            color: var(--color-text-light);
        }
        
        /* Question Form */
        .question-form {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-top: 1.5rem;
        }
        
        .question-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .question-label {
            font-weight: 600;
            color: var(--color-text);
            font-size: 0.95rem;
        }
        
        .question-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .radio-option:hover,
        .checkbox-option:hover {
            background: var(--color-bg);
            border-color: var(--color-primary);
        }
        
        .radio-option.selected {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
        }
        
        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .radio-option label,
        .checkbox-option label {
            flex: 1;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--color-text);
        }
        
        .text-input,
        .textarea-input {
            padding: 0.75rem;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
        }
        
        .text-input:focus,
        .textarea-input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 128, 128, 0.1);
        }
        
        .char-counter {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            text-align: right;
            margin-top: 0.25rem;
        }
        
        .char-counter.valid {
            color: var(--color-success);
        }
        
        .char-counter.invalid {
            color: var(--color-error);
        }
        
        .validation-message {
            font-size: 0.85rem;
            color: var(--color-error);
            margin-top: 0.5rem;
            display: none;
        }
        
        .validation-message.show {
            display: block;
        }
        
        /* Retention Offer */
        .retention-offer {
            background: linear-gradient(135deg, var(--color-primary-light) 0%, rgba(0, 128, 128, 0.05) 100%);
            border: 2px solid var(--color-primary);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
        }
        
        .retention-offer h3 {
            color: var(--color-primary-dark);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .retention-offer p {
            color: var(--color-text);
            font-size: 1.05rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .offer-features {
            text-align: left;
            margin: 1.5rem 0;
            padding-left: 1rem;
        }
        
        .offer-features li {
            color: var(--color-text);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .offer-features i {
            color: var(--color-primary);
            font-size: 1.1rem;
        }
        
        .offer-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        /* Buttons */
        .btn-primary-action {
            background: var(--color-primary);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary-action:hover:not(:disabled) {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 128, 128, 0.3);
        }
        
        .btn-primary-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary-action {
            background: white;
            color: var(--color-text);
            padding: 1rem 2rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-secondary-action:hover {
            border-color: var(--color-text-light);
            background: var(--color-bg);
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .navigation-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        /* Confirmation Section */
        .confirmation-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            border-radius: 0 8px 8px 0;
            margin: 1.5rem 0;
        }
        
        .confirmation-warning h4 {
            color: #856404;
            margin: 0 0 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .confirmation-warning ul {
            margin: 0.5rem 0 0 1.5rem;
            color: #856404;
        }
        
        .confirmation-details {
            background: var(--color-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--color-border);
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: var(--color-text-light);
            font-weight: 500;
        }
        
        .detail-value {
            color: var(--color-text);
            font-weight: 600;
        }
        
        /* Loading State */
        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .processing-overlay.show {
            display: flex;
        }
        
        .processing-content {
            background: white;
            padding: 3rem;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
        }
        
        .processing-content i {
            font-size: 3rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .cancellation-container {
                padding: 1rem;
                margin: 1rem auto;
            }
            
            .cancellation-card {
                padding: 1.5rem;
            }
            
            .cancellation-steps {
                gap: 0.5rem;
            }
            
            .step {
                max-width: 100px;
            }
            
            .step-circle {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            
            .step-label {
                font-size: 0.75rem;
            }
            
            .offer-actions,
            .navigation-buttons {
                flex-direction: column;
            }
            
            .btn-primary-action,
            .btn-secondary-action,
            .btn-danger {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            .confirmation-warning {
                background: rgba(255, 193, 7, 0.2);
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="index.html"><img src="assets/images/prokaiwa-logo.jpg" alt="Prokaiwa Logo" class="logo" /></a>
            <button class="burger-menu" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li>
                        <div class="nav-lang-toggle">
                            <button data-lang="ja" aria-label="æ—¥æœ¬èªã«åˆ‡ã‚Šæ›¿ãˆ">æ—¥æœ¬èª</button>
                            <button data-lang="en" aria-label="Switch to English">English</button>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <!-- Processing Overlay -->
        <div class="processing-overlay" id="processing-overlay">
            <div class="processing-content">
                <i class="fas fa-spinner"></i>
                <h3 id="processing-text">å‡¦ç†ä¸­...</h3>
            </div>
        </div>

        <!-- JAPANESE VERSION -->
        <section id="ja-cancellation" class="lang-section" lang="ja">
            <div class="cancellation-container">
                <!-- Header -->
                <div class="cancellation-header">
                    <h1>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«</h1>
                    <p>ãŠåˆ¥ã‚Œã™ã‚‹å‰ã«ã€æ”¹å–„ã®ãŠæ‰‹ä¼ã„ã‚’ã•ã›ã¦ãã ã•ã„</p>
                </div>

                <!-- Progress Steps -->
                <div class="cancellation-steps">
                    <div class="step active" id="ja-step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">ç†ç”±</div>
                    </div>
                    <div class="step" id="ja-step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">è©³ç´°</div>
                    </div>
                    <div class="step" id="ja-step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">ç¢ºèª</div>
                    </div>
                </div>

                <!-- Cancellation Card -->
                <div class="cancellation-card">
                    <!-- STEP 1: Reason Selection -->
                    <div class="step-section active" id="ja-section-reason">
                        <h2>ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹ç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„</h2>
                        <p style="color: var(--color-text-light); margin-bottom: 1rem;">
                            ã‚ãªãŸã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ã®æ”¹å–„ã«å½¹ç«‹ã¡ã¾ã™
                        </p>

                        <div class="reason-grid" id="ja-reason-grid"></div>

                        <div class="navigation-buttons">
                            <button class="btn-primary-action" onclick="proceedToDetails('ja')" id="ja-btn-continue-step1" disabled>
                                æ¬¡ã¸ <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- STEP 2: Detailed Questions -->
                    <div class="step-section" id="ja-section-details">
                        <h2 id="ja-details-title">è©³ã—ãæ•™ãˆã¦ãã ã•ã„</h2>
                        <div class="question-form" id="ja-question-form"></div>

                        <div class="navigation-buttons">
                            <button class="btn-secondary-action" onclick="goBack('ja', 'details')">
                                <i class="fas fa-arrow-left"></i> æˆ»ã‚‹
                            </button>
                            <button class="btn-primary-action" onclick="proceedToOfferOrConfirm('ja')" id="ja-btn-continue-step2">
                                æ¬¡ã¸ <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- HIDDEN STEP: Retention Offer -->
                    <div class="step-section" id="ja-section-offer"></div>

                    <!-- STEP 3: Final Confirmation -->
                    <div class="step-section" id="ja-section-confirm">
                        <h2>æœ¬å½“ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ</h2>
                        
                        <div class="confirmation-warning">
                            <h4><i class="fas fa-exclamation-triangle"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã¨å¤±ã†ã‚‚ã®ï¼š</h4>
                            <ul id="ja-loss-list"></ul>
                        </div>

                        <div class="confirmation-details">
                            <div class="detail-row">
                                <span class="detail-label">ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³</span>
                                <span class="detail-value" id="ja-confirm-plan">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ã‚¢ã‚¯ã‚»ã‚¹çµ‚äº†æ—¥</span>
                                <span class="detail-value" id="ja-confirm-end-date">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±</span>
                                <span class="detail-value" id="ja-confirm-reason">-</span>
                            </div>
                        </div>

                        <div class="navigation-buttons">
                            <button class="btn-secondary-action" onclick="goBack('ja', 'confirm')">
                                <i class="fas fa-arrow-left"></i> æˆ»ã‚‹
                            </button>
                            <button class="btn-danger" onclick="confirmCancellation('ja')">
                                <i class="fas fa-times-circle"></i> ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ç¢ºå®š
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ENGLISH VERSION -->
        <section id="en-cancellation" class="lang-section" lang="en">
            <div class="cancellation-container">
                <!-- Header -->
                <div class="cancellation-header">
                    <h1>Cancel Subscription</h1>
                    <p>Before you go, let us help make things better</p>
                </div>

                <!-- Progress Steps -->
                <div class="cancellation-steps">
                    <div class="step active" id="en-step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Reason</div>
                    </div>
                    <div class="step" id="en-step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Details</div>
                    </div>
                    <div class="step" id="en-step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Confirm</div>
                    </div>
                </div>

                <!-- Cancellation Card -->
                <div class="cancellation-card">
                    <!-- STEP 1: Reason Selection -->
                    <div class="step-section active" id="en-section-reason">
                        <h2>Why are you cancelling?</h2>
                        <p style="color: var(--color-text-light); margin-bottom: 1rem;">
                            Your feedback helps us improve our service
                        </p>

                        <div class="reason-grid" id="en-reason-grid"></div>

                        <div class="navigation-buttons">
                            <button class="btn-primary-action" onclick="proceedToDetails('en')" id="en-btn-continue-step1" disabled>
                                Continue <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- STEP 2: Detailed Questions -->
                    <div class="step-section" id="en-section-details">
                        <h2 id="en-details-title">Tell us more</h2>
                        <div class="question-form" id="en-question-form"></div>

                        <div class="navigation-buttons">
                            <button class="btn-secondary-action" onclick="goBack('en', 'details')">
                                <i class="fas fa-arrow-left"></i> Go Back
                            </button>
                            <button class="btn-primary-action" onclick="proceedToOfferOrConfirm('en')" id="en-btn-continue-step2">
                                Continue <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- HIDDEN STEP: Retention Offer -->
                    <div class="step-section" id="en-section-offer"></div>

                    <!-- STEP 3: Final Confirmation -->
                    <div class="step-section" id="en-section-confirm">
                        <h2>Are you sure you want to cancel?</h2>
                        
                        <div class="confirmation-warning">
                            <h4><i class="fas fa-exclamation-triangle"></i> You'll lose access to:</h4>
                            <ul id="en-loss-list"></ul>
                        </div>

                        <div class="confirmation-details">
                            <div class="detail-row">
                                <span class="detail-label">Current Plan</span>
                                <span class="detail-value" id="en-confirm-plan">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Access Until</span>
                                <span class="detail-value" id="en-confirm-end-date">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Cancellation Reason</span>
                                <span class="detail-value" id="en-confirm-reason">-</span>
                            </div>
                        </div>

                        <div class="navigation-buttons">
                            <button class="btn-secondary-action" onclick="goBack('en', 'confirm')">
                                <i class="fas fa-arrow-left"></i> Go Back
                            </button>
                            <button class="btn-danger" onclick="confirmCancellation('en')">
                                <i class="fas fa-times-circle"></i> Confirm Cancellation
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="commerce-disclosure.html">Commerce Disclosure</a></li>
                        <li><a href="privacy-policy.html">Privacy Policy</a></li>
                        <li><a href="terms-of-service.html">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Connect</h3>
                    <div class="footer-social-icons">
                        <a href="https://page.line.me/845irjbc" class="social-icon" target="_blank" aria-label="LINE"><i class="fab fa-line"></i></a>
                        <a href="https://www.instagram.com/prokaiwa.english/" class="social-icon" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://x.com/ProkaiwaEnglish" class="social-icon" target="_blank" aria-label="X (formerly Twitter)"><i class="fab fa-x-twitter"></i></a>
                    </div>
                    <a href="mailto:prokaiwa.english@gmail.com" class="footer-email">prokaiwa.english@gmail.com</a>
                </div>
            </div>
            <p>Â© <span id="year"></span> Prokaiwa. All rights reserved.</p>
        </div>
    </footer>

    <script src="assets/js/script.js"></script>
    <script type="module">
// =====================================================
// ENHANCED CANCELLATION RETENTION SYSTEM
// =====================================================

import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

const supabase = createClient(
    'https://luyzyzefgintksydmwoh.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx1eXp5emVmZ2ludGtzeWRtd29oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5NzYyMDUsImV4cCI6MjA2ODU1MjIwNX0.he5_j99ZtAj4K_zzgm11NEEv7TrbRJYndJXot25s_Kg',
    {
        auth: {
            persistSession: true,
            storageKey: 'prokaiwa-supabase-auth',
            storage: window.localStorage,
            autoRefreshToken: true,
            detectSessionInUrl: true
        }
    }
);

// =====================================================
// CANCELLATION REASONS
// =====================================================

const cancellationReasons = {
    ja: [
        {
            id: 'expensive',
            icon: 'ğŸ’°',
            title: 'æ–™é‡‘ãŒé«˜ã™ãã‚‹',
            subtitle: 'äºˆç®—ã«åˆã‚ãªã„'
        },
        {
            id: 'not_using',
            icon: 'ğŸ“…',
            title: 'ã‚ã¾ã‚Šåˆ©ç”¨ã—ã¦ã„ãªã„',
            subtitle: 'æ™‚é–“ãŒãªã„ãƒ»å¿˜ã‚Œã¦ã—ã¾ã†'
        },
        {
            id: 'too_difficult',
            icon: 'ğŸ˜“',
            title: 'å†…å®¹ãŒé›£ã—ã™ãã‚‹',
            subtitle: 'ãƒ¬ãƒ™ãƒ«ãŒåˆã‚ãªã„'
        },
        {
            id: 'too_easy',
            icon: 'ğŸ˜´',
            title: 'å†…å®¹ãŒç°¡å˜ã™ãã‚‹',
            subtitle: 'ç‰©è¶³ã‚Šãªã„ãƒ»é€€å±ˆ'
        },
        {
            id: 'scheduling',
            icon: 'â°',
            title: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒåˆã‚ãªã„',
            subtitle: 'ãƒ¬ãƒƒã‚¹ãƒ³æ™‚é–“ãŒå–ã‚Œãªã„'
        },
        {
            id: 'technical',
            icon: 'ğŸ›',
            title: 'æŠ€è¡“çš„ãªå•é¡Œ',
            subtitle: 'ãƒã‚°ã‚„ä¸å…·åˆãŒã‚ã‚‹'
        },
        {
            id: 'goals_met',
            icon: 'ğŸ¯',
            title: 'ç›®æ¨™ã‚’é”æˆã—ãŸ',
            subtitle: 'ã‚‚ã†å¿…è¦ãªã„'
        },
        {
            id: 'switching',
            icon: 'ğŸ”„',
            title: 'ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã‚‹',
            subtitle: 'åˆ¥ã®é¸æŠè‚¢ã‚’è©¦ã—ãŸã„'
        },
        {
            id: 'circumstances',
            icon: 'ğŸ‘¤',
            title: 'å€‹äººçš„ãªäº‹æƒ…',
            subtitle: 'ç”Ÿæ´»çŠ¶æ³ãŒå¤‰ã‚ã£ãŸ'
        },
        {
            id: 'other',
            icon: 'ğŸ“',
            title: 'ãã®ä»–ã®ç†ç”±',
            subtitle: 'è©³ç´°ã‚’æ•™ãˆã¦ãã ã•ã„'
        }
    ],
    en: [
        {
            id: 'expensive',
            icon: 'ğŸ’°',
            title: "It's too expensive",
            subtitle: "Doesn't fit my budget"
        },
        {
            id: 'not_using',
            icon: 'ğŸ“…',
            title: "I'm not using it enough",
            subtitle: "Don't have time / Keep forgetting"
        },
        {
            id: 'too_difficult',
            icon: 'ğŸ˜“',
            title: 'Content is too difficult',
            subtitle: "Level doesn't match"
        },
        {
            id: 'too_easy',
            icon: 'ğŸ˜´',
            title: 'Content is too easy',
            subtitle: 'Not challenging enough'
        },
        {
            id: 'scheduling',
            icon: 'â°',
            title: "Schedule doesn't work",
            subtitle: "Can't find time for lessons"
        },
        {
            id: 'technical',
            icon: 'ğŸ›',
            title: 'Technical problems',
            subtitle: 'Bugs or issues with the service'
        },
        {
            id: 'goals_met',
            icon: 'ğŸ¯',
            title: 'Achieved my goals',
            subtitle: "Don't need it anymore"
        },
        {
            id: 'switching',
            icon: 'ğŸ”„',
            title: 'Switching to another service',
            subtitle: 'Want to try something different'
        },
        {
            id: 'circumstances',
            icon: 'ğŸ‘¤',
            title: 'Personal circumstances',
            subtitle: 'Life situation changed'
        },
        {
            id: 'other',
            icon: 'ğŸ“',
            title: 'Other reason',
            subtitle: 'Please tell us more'
        }
    ]
};

// =====================================================
// REASON-SPECIFIC QUESTIONS
// =====================================================

const reasonQuestions = {
    expensive: {
        ja: [
            {
                id: 'value_aspect',
                type: 'radio',
                question: 'ã©ã®æ©Ÿèƒ½ãŒä¸€ç•ªä¾¡å€¤ãŒã‚ã‚‹ã¨æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'line_practice', label: 'æ¯æ—¥ã®LINEç·´ç¿’' },
                    { value: 'video_lessons', label: 'è¬›å¸«ã¨ã®ãƒ“ãƒ‡ã‚ªãƒ¬ãƒƒã‚¹ãƒ³' },
                    { value: 'feedback', label: 'ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯' },
                    { value: 'progress', label: 'é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°' },
                    { value: 'combination', label: 'ã™ã¹ã¦ã®çµ„ã¿åˆã‚ã›' }
                ]
            },
            {
                id: 'reasonable_price',
                type: 'radio',
                question: 'å¾—ã‚‰ã‚Œã‚‹ä¾¡å€¤ã«å¯¾ã—ã¦ã€é©æ­£ã ã¨æ€ã†æœˆé¡æ–™é‡‘ã¯ï¼Ÿ',
                required: true,
                options: [
                    { value: 'under_3000', label: 'Â¥3,000æœªæº€' },
                    { value: '3000_4000', label: 'Â¥3,000-4,000' },
                    { value: '4000_5000', label: 'Â¥4,000-5,000' },
                    { value: '5000_6000', label: 'Â¥5,000-6,000' },
                    { value: '6000_8000', label: 'Â¥6,000-8,000' }
                ]
            },
            {
                id: 'price_perception',
                type: 'radio',
                question: 'æ–™é‡‘ã«ã¤ã„ã¦ã€ã©ã®ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'much_higher', label: 'äºˆæƒ³ã‚ˆã‚Šã‹ãªã‚Šé«˜ã„' },
                    { value: 'slightly_higher', label: 'äºˆæƒ³ã‚ˆã‚Šå°‘ã—é«˜ã„' },
                    { value: 'fair_but_cant_afford', label: 'é©æ­£ã ãŒã€ä»Šã¯æ‰•ãˆãªã„' },
                    { value: 'found_cheaper', label: 'ã‚ˆã‚Šå®‰ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ãŸ' }
                ]
            },
            {
                id: 'stay_if_affordable',
                type: 'radio',
                question: 'ã‚ˆã‚Šæ‰‹é ƒãªãƒ—ãƒ©ãƒ³ãŒã‚ã‚Œã°ç¶™ç¶šã—ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_definitely', label: 'ã¯ã„ã€ãœã²ç¶™ç¶šã—ãŸã„' },
                    { value: 'yes_depending', label: 'ã¯ã„ã€å†…å®¹æ¬¡ç¬¬' },
                    { value: 'maybe', label: 'ãŸã¶ã‚“ã€è©³ç´°ã‚’è¦‹ãŸã„' },
                    { value: 'no', label: 'ã„ã„ãˆã€ä¾¡æ ¼ã ã‘ãŒå•é¡Œã§ã¯ãªã„' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'æ–™é‡‘ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šã‚‚ã†å°‘ã—å®‰ã‘ã‚Œã°ç¶šã‘ãŸã„ã§ã™...'
            }
        ],
        en: [
            {
                id: 'value_aspect',
                type: 'radio',
                question: 'Which aspect provides the most value to you?',
                required: true,
                options: [
                    { value: 'line_practice', label: 'Daily LINE practice' },
                    { value: 'video_lessons', label: 'Video lessons with teachers' },
                    { value: 'feedback', label: 'Personalized feedback' },
                    { value: 'progress', label: 'Progress tracking' },
                    { value: 'combination', label: 'Combination of everything' }
                ]
            },
            {
                id: 'reasonable_price',
                type: 'radio',
                question: 'What monthly price would feel reasonable for the value?',
                required: true,
                options: [
                    { value: 'under_3000', label: 'Under Â¥3,000' },
                    { value: '3000_4000', label: 'Â¥3,000-4,000' },
                    { value: '4000_5000', label: 'Â¥4,000-5,000' },
                    { value: '5000_6000', label: 'Â¥5,000-6,000' },
                    { value: '6000_8000', label: 'Â¥6,000-8,000' }
                ]
            },
            {
                id: 'price_perception',
                type: 'radio',
                question: 'How does our pricing compare to your expectations?',
                required: true,
                options: [
                    { value: 'much_higher', label: 'Much higher than expected' },
                    { value: 'slightly_higher', label: 'Slightly higher than expected' },
                    { value: 'fair_but_cant_afford', label: "Fair, but I can't afford it right now" },
                    { value: 'found_cheaper', label: 'I found a cheaper alternative' }
                ]
            },
            {
                id: 'stay_if_affordable',
                type: 'radio',
                question: 'Would you stay if we offered a more affordable plan?',
                required: true,
                options: [
                    { value: 'yes_definitely', label: 'Yes, definitely' },
                    { value: 'yes_depending', label: "Yes, depending on what's included" },
                    { value: 'maybe', label: "Maybe, I'd need to see the details" },
                    { value: 'no', label: "No, price isn't the only issue" }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about pricing?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I would continue if it were more affordable...'
            }
        ]
    },

    not_using: {
        ja: [
            {
                id: 'usage_frequency',
                type: 'radio',
                question: 'å…ˆæœˆã€å®Ÿéš›ã«ã©ã®ãã‚‰ã„åˆ©ç”¨ã—ã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'daily', label: 'æ¯æ—¥ï¼ˆé€±5-7æ—¥ï¼‰' },
                    { value: 'regularly', label: 'å®šæœŸçš„ï¼ˆé€±3-4æ—¥ï¼‰' },
                    { value: 'occasionally', label: 'ãŸã¾ã«ï¼ˆé€±1-2æ—¥ï¼‰' },
                    { value: 'rarely', label: 'ã»ã¨ã‚“ã©ä½¿ã‚ãªã‹ã£ãŸ' },
                    { value: 'not_at_all', label: 'å…¨ãä½¿ã‚ãªã‹ã£ãŸ' }
                ]
            },
            {
                id: 'reason_not_using',
                type: 'radio',
                question: 'ã‚ã¾ã‚Šä½¿ã‚ãªã‹ã£ãŸä¸»ãªç†ç”±ã¯ï¼Ÿ',
                required: true,
                options: [
                    { value: 'too_busy', label: 'ä»•äº‹ã‚„ç”Ÿæ´»ãŒå¿™ã—ã™ãã‚‹' },
                    { value: 'keep_forgetting', label: 'å¿˜ã‚Œã¦ã—ã¾ã†' },
                    { value: 'lost_motivation', label: 'ã‚„ã‚‹æ°—ãŒãªããªã£ãŸ' },
                    { value: 'harder_than_expected', label: 'æ€ã£ãŸã‚ˆã‚Šé›£ã—ã„' },
                    { value: 'not_seeing_progress', label: 'ä¸Šé”ã‚’å®Ÿæ„Ÿã§ããªã„' },
                    { value: 'other', label: 'ãã®ä»–' }
                ]
            },
            {
                id: 'feeling_when_using',
                type: 'radio',
                question: 'å®Ÿéš›ã«ä½¿ã£ãŸã¨ãã€ã©ã†æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'enjoy_and_learn', label: 'æ¥½ã—ãå­¦ã¹ã¦ã„ã‚‹' },
                    { value: 'okay_not_exciting', label: 'æ‚ªããªã„ãŒã€ã‚ã¾ã‚Šåˆºæ¿€çš„ã§ã¯ãªã„' },
                    { value: 'feels_like_chore', label: 'ç¾©å‹™ã®ã‚ˆã†ã«æ„Ÿã˜ã‚‹' },
                    { value: 'not_improving', label: 'ä¸Šé”ã—ã¦ã„ã‚‹æ°—ãŒã—ãªã„' }
                ]
            },
            {
                id: 'what_would_help',
                type: 'radio',
                question: 'ã©ã†ã™ã‚Œã°ç¶™ç¶šçš„ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'shorter_sessions', label: 'ã‚‚ã£ã¨çŸ­ã„ãƒ¬ãƒƒã‚¹ãƒ³' },
                    { value: 'more_engaging', label: 'ã‚‚ã£ã¨æ¥½ã—ã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„' },
                    { value: 'reminders', label: 'ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã¨åŠ±ã¾ã—' },
                    { value: 'faster_results', label: 'ã‚ˆã‚Šæ—©ãçµæœãŒè¦‹ãˆã‚‹' },
                    { value: 'flexible_schedule', label: 'ã‚ˆã‚ŠæŸ”è»Ÿãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«' },
                    { value: 'nothing_helps', label: 'ä»Šã¯ä½•ã‚‚å½¹ã«ç«‹ãŸãªã„' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'åˆ©ç”¨é »åº¦ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šæ™‚é–“ã‚’ä½œã‚ŠãŸã„ã®ã§ã™ãŒ...'
            }
        ],
        en: [
            {
                id: 'usage_frequency',
                type: 'radio',
                question: 'How often did you actually use Prokaiwa in the past month?',
                required: true,
                options: [
                    { value: 'daily', label: 'Daily (5-7 days/week)' },
                    { value: 'regularly', label: 'Regularly (3-4 days/week)' },
                    { value: 'occasionally', label: 'Occasionally (1-2 days/week)' },
                    { value: 'rarely', label: 'Rarely (few times in the month)' },
                    { value: 'not_at_all', label: 'Not at all' }
                ]
            },
            {
                id: 'reason_not_using',
                type: 'radio',
                question: "What's the main reason you're not using it more?",
                required: true,
                options: [
                    { value: 'too_busy', label: 'Too busy with work/life' },
                    { value: 'keep_forgetting', label: 'I keep forgetting' },
                    { value: 'lost_motivation', label: 'Lost motivation/interest' },
                    { value: 'harder_than_expected', label: "It's harder than I expected" },
                    { value: 'not_seeing_progress', label: "I don't see progress fast enough" },
                    { value: 'other', label: 'Other' }
                ]
            },
            {
                id: 'feeling_when_using',
                type: 'radio',
                question: 'When you DO use Prokaiwa, how do you feel about it?',
                required: true,
                options: [
                    { value: 'enjoy_and_learn', label: 'I enjoy it and learn from it' },
                    { value: 'okay_not_exciting', label: "It's okay, but not exciting" },
                    { value: 'feels_like_chore', label: 'It feels like a chore' },
                    { value: 'not_improving', label: "I don't feel like I'm improving" }
                ]
            },
            {
                id: 'what_would_help',
                type: 'radio',
                question: 'What would make you use it more consistently?',
                required: true,
                options: [
                    { value: 'shorter_sessions', label: 'Shorter, quicker sessions' },
                    { value: 'more_engaging', label: 'More engaging/fun content' },
                    { value: 'reminders', label: 'Reminders and accountability' },
                    { value: 'faster_results', label: 'Seeing faster results' },
                    { value: 'flexible_schedule', label: 'More flexible schedule' },
                    { value: 'nothing_helps', label: 'Nothing would help right now' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about your usage?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I want to use it more but...'
            }
        ]
    },

    too_difficult: {
        ja: [
            {
                id: 'struggle_areas',
                type: 'checkbox',
                question: 'æœ€ã‚‚è‹¦æˆ¦ã—ã¦ã„ã‚‹åˆ†é‡ã¯ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
                required: true,
                options: [
                    { value: 'grammar', label: 'æ–‡æ³•ã®èª¬æ˜ãŒç†è§£ã§ããªã„' },
                    { value: 'vocabulary', label: 'èªå½™ãŒé›£ã—ã™ãã‚‹' },
                    { value: 'speaking', label: 'è©±ã™ãƒ»ç™ºéŸ³ã®ç·´ç¿’' },
                    { value: 'comprehension', label: 'ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ç†è§£' },
                    { value: 'knowing_what_to_say', label: 'ä½•ã‚’è¨€ãˆã°ã„ã„ã‹ã‚ã‹ã‚‰ãªã„' },
                    { value: 'remembering', label: 'å­¦ã‚“ã ã“ã¨ã‚’è¦šãˆã‚‰ã‚Œãªã„' }
                ]
            },
            {
                id: 'feeling_during_practice',
                type: 'radio',
                question: 'ãƒ¬ãƒƒã‚¹ãƒ³ã‚„ç·´ç¿’ä¸­ã€ã©ã†æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'completely_lost', label: 'å®Œå…¨ã«ç†è§£ã§ããšåœ§å€’ã•ã‚Œã‚‹' },
                    { value: 'struggling_but_learning', label: 'è‹¦æˆ¦ã—ã¦ã„ã‚‹ãŒã€å°‘ã—ãšã¤å­¦ã¹ã¦ã„ã‚‹' },
                    { value: 'mostly_okay', label: 'ã»ã¨ã‚“ã©å¤§ä¸ˆå¤«ã ãŒã€æ™‚ã€…æ··ä¹±ã™ã‚‹' },
                    { value: 'pace_too_fast', label: 'ãƒšãƒ¼ã‚¹ãŒé€Ÿã™ãã‚‹' }
                ]
            },
            {
                id: 'reached_out_for_help',
                type: 'radio',
                question: 'é›£ã—ã„å†…å®¹ã«ã¤ã„ã¦ã€åŠ©ã‘ã‚’æ±‚ã‚ã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_still_struggled', label: 'ã¯ã„ã€ã§ã‚‚ã¾ã è‹¦æˆ¦ã—ã¦ã„ã‚‹' },
                    { value: 'no_didnt_know', label: 'ã„ã„ãˆã€ã‚µãƒãƒ¼ãƒˆãŒã‚ã‚‹ã“ã¨ã‚’çŸ¥ã‚‰ãªã‹ã£ãŸ' },
                    { value: 'no_embarrassed', label: 'ã„ã„ãˆã€æ¥ãšã‹ã—ãã¦èã‘ãªã‹ã£ãŸ' },
                    { value: 'no_no_time', label: 'ã„ã„ãˆã€æ™‚é–“ãŒãªã‹ã£ãŸ' }
                ]
            },
            {
                id: 'what_would_help',
                type: 'radio',
                question: 'ã©ã†ã™ã‚Œã°ã€ã‚ãªãŸã®ãƒ¬ãƒ™ãƒ«ã§æˆåŠŸã§ãã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'slower_progression', label: 'ã‚†ã£ãã‚Šã¨ã—ãŸé€²åº¦ã¨å¾©ç¿’' },
                    { value: 'japanese_explanations', label: 'æ—¥æœ¬èªã§ã®ã‚·ãƒ³ãƒ—ãƒ«ãªèª¬æ˜' },
                    { value: 'beginner_content', label: 'ã‚ˆã‚Šåˆå¿ƒè€…å‘ã‘ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„' },
                    { value: 'one_on_one', label: 'è¬›å¸«ã¨ã®ãƒãƒ³ãƒ„ãƒ¼ãƒãƒ³ã‚µãƒãƒ¼ãƒˆ' },
                    { value: 'lower_level', label: 'ã‚‚ã£ã¨ä½ã„ãƒ¬ãƒ™ãƒ«ã‹ã‚‰å§‹ã‚ã‚‹' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'é›£æ˜“åº¦ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šã‚‚ã£ã¨åŸºç¤ã‹ã‚‰å­¦ã³ãŸã„ã§ã™...'
            }
        ],
        en: [
            {
                id: 'struggle_areas',
                type: 'checkbox',
                question: 'Which areas do you struggle with most? (Select all that apply)',
                required: true,
                options: [
                    { value: 'grammar', label: 'Understanding grammar explanations' },
                    { value: 'vocabulary', label: 'Vocabulary is too advanced' },
                    { value: 'speaking', label: 'Speaking/pronunciation practice' },
                    { value: 'comprehension', label: 'Understanding native speed speech' },
                    { value: 'knowing_what_to_say', label: 'Knowing what to say in conversations' },
                    { value: 'remembering', label: 'Remembering what I learned' }
                ]
            },
            {
                id: 'feeling_during_practice',
                type: 'radio',
                question: 'How do you feel during lessons/practice?',
                required: true,
                options: [
                    { value: 'completely_lost', label: 'Completely lost and overwhelmed' },
                    { value: 'struggling_but_learning', label: 'Struggling but learning some things' },
                    { value: 'mostly_okay', label: 'Mostly okay with occasional confusion' },
                    { value: 'pace_too_fast', label: 'The pace is just too fast for me' }
                ]
            },
            {
                id: 'reached_out_for_help',
                type: 'radio',
                question: 'Did you reach out for help with difficult content?',
                required: true,
                options: [
                    { value: 'yes_still_struggled', label: 'Yes, but I still struggled' },
                    { value: 'no_didnt_know', label: "No, I didn't know help was available" },
                    { value: 'no_embarrassed', label: 'No, I felt embarrassed to ask' },
                    { value: 'no_no_time', label: "No, I didn't have time" }
                ]
            },
            {
                id: 'what_would_help',
                type: 'radio',
                question: 'What would help you succeed at your level?',
                required: true,
                options: [
                    { value: 'slower_progression', label: 'Slower progression with more review' },
                    { value: 'japanese_explanations', label: 'Simpler explanations in Japanese' },
                    { value: 'beginner_content', label: 'More beginner-friendly content' },
                    { value: 'one_on_one', label: 'One-on-one help from a teacher' },
                    { value: 'lower_level', label: 'Starting at a lower level' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about the difficulty level?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I wish there was more foundational content...'
            }
        ]
    },

    too_easy: {
        ja: [
            {
                id: 'current_level',
                type: 'radio',
                question: 'ã‚ãªãŸã®ç¾åœ¨ã®è‹±èªãƒ¬ãƒ™ãƒ«ã¯ï¼Ÿ',
                required: true,
                options: [
                    { value: 'advanced', label: 'ä¸Šç´šï¼ˆC1-C2ï¼‰ï¼šãƒã‚¤ãƒ†ã‚£ãƒ–ã«è¿‘ã„æµæš¢ã•' },
                    { value: 'upper_intermediate', label: 'æº–ä¸Šç´šï¼ˆB2ï¼‰ï¼šè‡ªä¿¡ã‚’æŒã£ã¦ä¼šè©±ã§ãã‚‹' },
                    { value: 'intermediate', label: 'ä¸­ç´šï¼ˆB1ï¼‰ï¼šæ—¥å¸¸çš„ãªçŠ¶æ³ã«å¯¾å¿œã§ãã‚‹' },
                    { value: 'not_advanced', label: 'å†…å®¹ã¯ç°¡å˜ã ãŒã€ãã“ã¾ã§ä¸Šç´šã§ã¯ãªã„' }
                ]
            },
            {
                id: 'want_to_improve',
                type: 'checkbox',
                question: 'ã¾ã ä¼¸ã°ã—ãŸã„åˆ†é‡ã¯ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
                required: true,
                options: [
                    { value: 'advanced_vocab', label: 'é«˜åº¦ãªèªå½™ãƒ»è¡¨ç¾' },
                    { value: 'business', label: 'ãƒ“ã‚¸ãƒã‚¹ãƒ»å°‚é–€è‹±èª' },
                    { value: 'pronunciation', label: 'è‡ªç„¶ãªç™ºéŸ³ã¨ã‚¤ãƒ³ãƒˆãƒãƒ¼ã‚·ãƒ§ãƒ³' },
                    { value: 'complex_grammar', label: 'è¤‡é›‘ãªæ–‡æ³•ï¼ˆä»®å®šæ³•ãªã©ï¼‰' },
                    { value: 'cultural_nuances', label: 'æ–‡åŒ–çš„ãªãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã¨æ…£ç”¨å¥' },
                    { value: 'fluency_speed', label: 'æµæš¢ã•ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰' },
                    { value: 'none', label: 'ãªã—ã€ç›®æ¨™ã‚’é”æˆã—ãŸ' }
                ]
            },
            {
                id: 'challenging_content',
                type: 'radio',
                question: 'ã©ã‚“ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãªã‚‰æŒ‘æˆ¦çš„ã§ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'news', label: 'ãƒªã‚¢ãƒ«ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã¨æ™‚äº‹å•é¡Œ' },
                    { value: 'business', label: 'ãƒ“ã‚¸ãƒã‚¹ã‚·ãƒŠãƒªã‚ªã¨ãƒ—ãƒ¬ã‚¼ãƒ³' },
                    { value: 'academic', label: 'ã‚¢ã‚«ãƒ‡ãƒŸãƒƒã‚¯ãƒ»æŠ€è¡“è‹±èª' },
                    { value: 'debate', label: 'ãƒ‡ã‚£ãƒ™ãƒ¼ãƒˆã¨è­°è«–' },
                    { value: 'creative', label: 'ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°' },
                    { value: 'no_need', label: 'ã‚‚ã†è‹±èªã®ç·´ç¿’ã¯å¿…è¦ãªã„' }
                ]
            },
            {
                id: 'stay_for_advanced',
                type: 'radio',
                question: 'ã‚ˆã‚Šé«˜åº¦ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚Œã°ç¶™ç¶šã—ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_if_challenging', label: 'ã¯ã„ã€æœ¬å½“ã«æŒ‘æˆ¦çš„ãªã‚‰' },
                    { value: 'maybe_depending', label: 'ãŸã¶ã‚“ã€ãƒˆãƒ”ãƒƒã‚¯æ¬¡ç¬¬' },
                    { value: 'no_satisfied', label: 'ã„ã„ãˆã€ä»Šã®ãƒ¬ãƒ™ãƒ«ã§æº€è¶³' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ¬ãƒ™ãƒ«ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šã‚‚ã£ã¨é›£ã—ã„å†…å®¹ãŒæ¬²ã—ã„ã§ã™...'
            }
        ],
        en: [
            {
                id: 'current_level',
                type: 'radio',
                question: 'How would you rate your current English level?',
                required: true,
                options: [
                    { value: 'advanced', label: 'Advanced (C1-C2): Near-native fluency' },
                    { value: 'upper_intermediate', label: 'Upper-Intermediate (B2): Confident conversations' },
                    { value: 'intermediate', label: 'Intermediate (B1): Can handle most daily situations' },
                    { value: 'not_advanced', label: "The content is easy but I'm not that advanced" }
                ]
            },
            {
                id: 'want_to_improve',
                type: 'checkbox',
                question: 'Which areas do you still want to improve? (Select all that apply)',
                required: true,
                options: [
                    { value: 'advanced_vocab', label: 'Advanced vocabulary/expressions' },
                    { value: 'business', label: 'Business/professional English' },
                    { value: 'pronunciation', label: 'Natural pronunciation and intonation' },
                    { value: 'complex_grammar', label: 'Complex grammar (conditionals, subjunctive, etc.)' },
                    { value: 'cultural_nuances', label: 'Cultural nuances and idioms' },
                    { value: 'fluency_speed', label: 'Fluency and speed' },
                    { value: 'none', label: "None, I've achieved my goals" }
                ]
            },
            {
                id: 'challenging_content',
                type: 'radio',
                question: 'What type of content would challenge you?',
                required: true,
                options: [
                    { value: 'news', label: 'Real-world news and current events' },
                    { value: 'business', label: 'Business scenarios and presentations' },
                    { value: 'academic', label: 'Academic/technical English' },
                    { value: 'debate', label: 'Debate and argumentation' },
                    { value: 'creative', label: 'Creative writing and storytelling' },
                    { value: 'no_need', label: "I don't need more English practice" }
                ]
            },
            {
                id: 'stay_for_advanced',
                type: 'radio',
                question: 'Would you stay for more advanced content?',
                required: true,
                options: [
                    { value: 'yes_if_challenging', label: 'Yes, if it was truly challenging' },
                    { value: 'maybe_depending', label: 'Maybe, depending on the topics' },
                    { value: 'no_satisfied', label: "No, I'm satisfied with my level now" }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about the content level?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I need more challenging materials...'
            }
        ]
    },

    scheduling: {
        ja: [
            {
                id: 'scheduling_issue',
                type: 'radio',
                question: 'å…·ä½“çš„ãªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å•é¡Œã¯ï¼Ÿ',
                required: true,
                options: [
                    { value: 'work_conflicts', label: 'ä»•äº‹ã®æ™‚é–“ã¨é‡ãªã‚‹' },
                    { value: 'irregular_schedule', label: 'ä¸è¦å‰‡ãªäºˆå®š' },
                    { value: 'timezone', label: 'æ™‚å·®ã®å•é¡Œ' },
                    { value: 'family', label: 'å®¶æ—ãƒ»å€‹äººçš„ãªéƒ½åˆ' },
                    { value: 'need_flexibility', label: 'ã‚‚ã£ã¨æŸ”è»Ÿãªäºˆç´„ãŒå¿…è¦' }
                ]
            },
            {
                id: 'issue_with',
                type: 'radio',
                question: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å•é¡Œã¯ï¼š',
                required: true,
                options: [
                    { value: 'video_only', label: 'ãƒ“ãƒ‡ã‚ªãƒ¬ãƒƒã‚¹ãƒ³ã®ã¿' },
                    { value: 'line_practice', label: 'æ¯æ—¥ã®LINEç·´ç¿’' },
                    { value: 'both', label: 'ãƒ¬ãƒƒã‚¹ãƒ³ã¨ç·´ç¿’ã®ä¸¡æ–¹' },
                    { value: 'life_hectic', label: 'å…¨ä½“çš„ã«ç”Ÿæ´»ãŒå¿™ã—ã™ãã‚‹' }
                ]
            },
            {
                id: 'what_would_solve',
                type: 'radio',
                question: 'ã©ã†ã™ã‚Œã°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å•é¡ŒãŒè§£æ±ºã—ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'more_times', label: 'æ—©æœãƒ»æ·±å¤œã®æ ã‚’å¢—ã‚„ã™' },
                    { value: 'recorded', label: 'ã„ã¤ã§ã‚‚è¦‹ã‚‰ã‚Œã‚‹éŒ²ç”»ãƒ¬ãƒƒã‚¹ãƒ³' },
                    { value: 'shorter', label: 'ã‚ˆã‚ŠçŸ­ã„ãƒ¬ãƒƒã‚¹ãƒ³ï¼ˆ15-20åˆ†ï¼‰' },
                    { value: 'pause', label: 'å¿™ã—ã„ã¨ãã«ä¸€æ™‚åœæ­¢ã§ãã‚‹' },
                    { value: 'nothing', label: 'ä»Šã¯ä½•ã‚‚å½¹ã«ç«‹ãŸãªã„' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šã‚‚ã£ã¨æŸ”è»Ÿãªæ™‚é–“å¸¯ãŒã‚ã‚Œã°...'
            }
        ],
        en: [
            {
                id: 'scheduling_issue',
                type: 'radio',
                question: 'What specific scheduling issue are you facing?',
                required: true,
                options: [
                    { value: 'work_conflicts', label: 'Work hours conflict with available lesson times' },
                    { value: 'irregular_schedule', label: 'Irregular/unpredictable schedule' },
                    { value: 'timezone', label: 'Time zone differences' },
                    { value: 'family', label: 'Family/personal commitments' },
                    { value: 'need_flexibility', label: 'I need more flexibility in booking' }
                ]
            },
            {
                id: 'issue_with',
                type: 'radio',
                question: 'Is the scheduling issue with:',
                required: true,
                options: [
                    { value: 'video_only', label: 'Video lessons only' },
                    { value: 'line_practice', label: 'Daily LINE practice' },
                    { value: 'both', label: 'Both lessons and practice' },
                    { value: 'life_hectic', label: 'My overall life is too hectic right now' }
                ]
            },
            {
                id: 'what_would_solve',
                type: 'radio',
                question: 'What would solve your scheduling problem?',
                required: true,
                options: [
                    { value: 'more_times', label: 'More early/late time slots' },
                    { value: 'recorded', label: 'Recorded lessons I can watch anytime' },
                    { value: 'shorter', label: 'Shorter lessons (15-20 min)' },
                    { value: 'pause', label: 'Ability to pause when life gets busy' },
                    { value: 'nothing', label: 'Nothing right now, life is just too busy' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about scheduling?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I need more flexible timing...'
            }
        ]
    },

    technical: {
        ja: [
            {
                id: 'problems_experienced',
                type: 'checkbox',
                question: 'ã©ã‚“ãªæŠ€è¡“çš„å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
                required: true,
                options: [
                    { value: 'line_not_delivering', label: 'LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã‹ãªã„' },
                    { value: 'website_not_loading', label: 'ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒèª­ã¿è¾¼ã‚ãªã„' },
                    { value: 'video_quality', label: 'ãƒ“ãƒ‡ã‚ªé€šè©±ã®å“è³ªå•é¡Œ' },
                    { value: 'login_issues', label: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ»èªè¨¼ã®å•é¡Œ' },
                    { value: 'payment_errors', label: 'æ”¯æ‰•ã„ãƒ»è«‹æ±‚ã®ã‚¨ãƒ©ãƒ¼' }
                ]
            },
            {
                id: 'problem_frequency',
                type: 'radio',
                question: 'ã©ã®ãã‚‰ã„ã®é »åº¦ã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'constantly', label: 'å¸¸ã«ï¼ˆæ¯æ—¥ï¼‰' },
                    { value: 'frequently', label: 'é »ç¹ã«ï¼ˆé€±ã«æ•°å›ï¼‰' },
                    { value: 'occasionally', label: 'ãŸã¾ã«ï¼ˆé€±ã«1å›ï¼‰' },
                    { value: 'rarely', label: 'ã»ã¨ã‚“ã©ãªã„ï¼ˆæ•°å›ã ã‘ï¼‰' }
                ]
            },
            {
                id: 'reported_to_support',
                type: 'radio',
                question: 'ã‚µãƒãƒ¼ãƒˆã«å•é¡Œã‚’å ±å‘Šã—ã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_resolved', label: 'ã¯ã„ã€è§£æ±ºã•ã‚ŒãŸ' },
                    { value: 'yes_not_resolved', label: 'ã¯ã„ã€ã§ã‚‚è§£æ±ºã—ãªã‹ã£ãŸ' },
                    { value: 'yes_no_response', label: 'ã¯ã„ã€ã§ã‚‚è¿”ç­”ãŒãªã‹ã£ãŸ' },
                    { value: 'no', label: 'ã„ã„ãˆã€å ±å‘Šã—ãªã‹ã£ãŸ' }
                ]
            },
            {
                id: 'impact_on_experience',
                type: 'radio',
                question: 'ã“ã‚Œã‚‰ã®å•é¡Œã¯ã€ã©ã®ãã‚‰ã„å½±éŸ¿ã—ã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'unusable', label: 'å®Œå…¨ã«ä½¿ãˆãªããªã£ãŸ' },
                    { value: 'very_frustrating', label: 'éå¸¸ã«ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ã€å¤§ããªæ”¯éšœ' },
                    { value: 'annoying', label: 'ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ãŒã€ä½•ã¨ã‹ä½¿ãˆãŸ' },
                    { value: 'minor', label: 'ã‚ãšã‹ãªä¸ä¾¿' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'æŠ€è¡“çš„ãªå•é¡Œã«ã¤ã„ã¦ã€è©³ã—ãæ•™ãˆã¦ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šLINEã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã‹ãªã„ã“ã¨ãŒå¤šã...'
            }
        ],
        en: [
            {
                id: 'problems_experienced',
                type: 'checkbox',
                question: 'What technical problems did you experience? (Select all that apply)',
                required: true,
                options: [
                    { value: 'line_not_delivering', label: 'LINE messages not delivering' },
                    { value: 'website_not_loading', label: 'Website/dashboard not loading' },
                    { value: 'video_quality', label: 'Video call quality issues' },
                    { value: 'login_issues', label: 'Login/authentication problems' },
                    { value: 'payment_errors', label: 'Payment/billing errors' }
                ]
            },
            {
                id: 'problem_frequency',
                type: 'radio',
                question: 'How often did you encounter these problems?',
                required: true,
                options: [
                    { value: 'constantly', label: 'Constantly (daily)' },
                    { value: 'frequently', label: 'Frequently (few times per week)' },
                    { value: 'occasionally', label: 'Occasionally (once per week)' },
                    { value: 'rarely', label: 'Rarely (few times total)' }
                ]
            },
            {
                id: 'reported_to_support',
                type: 'radio',
                question: 'Did you report the issue to support?',
                required: true,
                options: [
                    { value: 'yes_resolved', label: 'Yes, and it was resolved' },
                    { value: 'yes_not_resolved', label: "Yes, but the solution didn't work" },
                    { value: 'yes_no_response', label: 'Yes, but I never heard back' },
                    { value: 'no', label: "No, I didn't report it" }
                ]
            },
            {
                id: 'impact_on_experience',
                type: 'radio',
                question: 'How much did these issues impact your experience?',
                required: true,
                options: [
                    { value: 'unusable', label: 'Made it completely unusable' },
                    { value: 'very_frustrating', label: 'Very frustrating, major disruption' },
                    { value: 'annoying', label: 'Annoying but I could work around it' },
                    { value: 'minor', label: 'Minor inconvenience' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Please describe the technical problems in detail',
                required: true,
                minLength: 20,
                placeholder: 'e.g., LINE messages often failed to deliver...'
            }
        ]
    },

    goals_met: {
        ja: [
            {
                id: 'original_goal',
                type: 'radio',
                question: 'ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼å½“åˆã®ç›®æ¨™ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'exam', label: 'ç‰¹å®šã®è©¦é¨“ã«åˆæ ¼ã™ã‚‹ï¼ˆTOEICã€IELTSãªã©ï¼‰' },
                    { value: 'conversation', label: 'æ—¥å¸¸ä¼šè©±ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹' },
                    { value: 'travel', label: 'æ—…è¡Œãƒ»æµ·å¤–ç”Ÿæ´»ã®æº–å‚™' },
                    { value: 'work', label: 'ä»•äº‹ãƒ»ã‚­ãƒ£ãƒªã‚¢ã®ãŸã‚' },
                    { value: 'personal', label: 'è‡ªå·±å•“ç™º' },
                    { value: 'other', label: 'ãã®ä»–' }
                ]
            },
            {
                id: 'time_to_achieve',
                type: 'radio',
                question: 'ç›®æ¨™é”æˆã«ã©ã®ãã‚‰ã„ã‹ã‹ã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'under_3', label: '3ãƒ¶æœˆæœªæº€' },
                    { value: '3_6', label: '3-6ãƒ¶æœˆ' },
                    { value: '6_12', label: '6-12ãƒ¶æœˆ' },
                    { value: 'over_year', label: '1å¹´ä»¥ä¸Š' }
                ]
            },
            {
                id: 'ongoing_needs',
                type: 'radio',
                question: 'ä»Šå¾Œã‚‚è‹±èªã‚’ä½¿ã†å¿…è¦ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'maintain', label: 'ã¯ã„ã€ãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ãŸã„' },
                    { value: 'keep_improving', label: 'ã¯ã„ã€ã•ã‚‰ã«ä¸Šé”ã—ãŸã„' },
                    { value: 'occasional', label: 'ãŸã¶ã‚“ã€ãŸã¾ã«ä½¿ã†ç¨‹åº¦' },
                    { value: 'no', label: 'ã„ã„ãˆã€ä»Šã®ãƒ¬ãƒ™ãƒ«ã§æº€è¶³' }
                ]
            },
            {
                id: 'use_maintenance',
                type: 'radio',
                question: 'è»½ã‚ã®ã€Œç¶­æŒãƒ—ãƒ©ãƒ³ã€ã‚’åˆ©ç”¨ã—ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_avoid_losing', label: 'ã¯ã„ã€å­¦ã‚“ã ã“ã¨ã‚’å¿˜ã‚Œãªã„ãŸã‚ã«' },
                    { value: 'maybe_if_affordable', label: 'ãŸã¶ã‚“ã€æ‰‹é ƒãªä¾¡æ ¼ãªã‚‰' },
                    { value: 'no_confident', label: 'ã„ã„ãˆã€è‡ªåˆ†ã§ç¶­æŒã§ãã‚‹è‡ªä¿¡ãŒã‚ã‚‹' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Prokaiwaã§ã®å­¦ç¿’ä½“é¨“ã«ã¤ã„ã¦ã€æ„Ÿæƒ³ã‚’ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šç›®æ¨™ã‚’é”æˆã§ãã¦å¬‰ã—ã„ã§ã™...'
            }
        ],
        en: [
            {
                id: 'original_goal',
                type: 'radio',
                question: 'Congratulations! What was your original goal?',
                required: true,
                options: [
                    { value: 'exam', label: 'Pass a specific exam (TOEIC, IELTS, etc.)' },
                    { value: 'conversation', label: 'Get comfortable with daily conversation' },
                    { value: 'travel', label: 'Prepare for travel/living abroad' },
                    { value: 'work', label: 'Improve for work/career' },
                    { value: 'personal', label: 'Personal enrichment' },
                    { value: 'other', label: 'Other' }
                ]
            },
            {
                id: 'time_to_achieve',
                type: 'radio',
                question: 'How long did it take to achieve your goal?',
                required: true,
                options: [
                    { value: 'under_3', label: 'Less than 3 months' },
                    { value: '3_6', label: '3-6 months' },
                    { value: '6_12', label: '6-12 months' },
                    { value: 'over_year', label: 'Over a year' }
                ]
            },
            {
                id: 'ongoing_needs',
                type: 'radio',
                question: 'Do you have any ongoing English needs?',
                required: true,
                options: [
                    { value: 'maintain', label: 'Yes, I need to maintain my level' },
                    { value: 'keep_improving', label: 'Yes, I want to keep improving' },
                    { value: 'occasional', label: 'Maybe, for occasional use' },
                    { value: 'no', label: "No, I'm satisfied where I am" }
                ]
            },
            {
                id: 'use_maintenance',
                type: 'radio',
                question: 'Would you use a light "maintenance plan"?',
                required: true,
                options: [
                    { value: 'yes_avoid_losing', label: 'Yes, to avoid losing what I learned' },
                    { value: 'maybe_if_affordable', label: 'Maybe, if it\'s very affordable' },
                    { value: 'no_confident', label: "No, I'm confident I'll maintain on my own" }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Please share your thoughts about your learning experience with Prokaiwa',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I\'m happy I achieved my goal...'
            }
        ]
    },

    switching: {
        ja: [
            {
                id: 'service_name',
                type: 'text',
                question: 'ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ',
                required: true,
                minLength: 2,
                placeholder: 'ã‚µãƒ¼ãƒ“ã‚¹åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
            },
            {
                id: 'what_attracted',
                type: 'radio',
                question: 'ãã®ã‚µãƒ¼ãƒ“ã‚¹ã®ä½•ãŒé­…åŠ›çš„ã§ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'lower_price', label: 'ã‚ˆã‚Šå®‰ã„' },
                    { value: 'features', label: 'Prokaiwaã«ãªã„æ©Ÿèƒ½ãŒã‚ã‚‹' },
                    { value: 'schedule', label: 'ã‚ˆã‚Šè‰¯ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»å½¢å¼' },
                    { value: 'recommended', label: 'å‹äººã«å‹§ã‚ã‚‰ã‚ŒãŸ' },
                    { value: 'marketing', label: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ»è©¦ç”¨ç‰ˆãŒè‰¯ã‹ã£ãŸ' }
                ]
            },
            {
                id: 'wish_we_had',
                type: 'textarea',
                question: 'ãã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ã£ã¦ã€Prokaiwaã«æ¬²ã—ã„æ©Ÿèƒ½ã¯ï¼Ÿ',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šã‚°ãƒ«ãƒ¼ãƒ—ãƒ¬ãƒƒã‚¹ãƒ³ã‚„ãƒã‚¤ãƒ†ã‚£ãƒ–ã¨ã®äº¤æµãªã©...'
            },
            {
                id: 'if_matched',
                type: 'radio',
                question: 'åŒç­‰ä»¥ä¸Šã®ææ¡ˆãŒã‚ã‚Œã°ã€ç¶™ç¶šã—ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_prefer', label: 'ã¯ã„ã€åŒç­‰ãªã‚‰ Prokaiwa ã®æ–¹ãŒå¥½ãã§ã™' },
                    { value: 'maybe', label: 'ãŸã¶ã‚“ã€è©³ç´°ã‚’è¦‹ãŸã„' },
                    { value: 'no', label: 'ã„ã„ãˆã€åˆ¥ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’è©¦ã—ãŸã„' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'ä»–ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®æ¯”è¼ƒã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šæ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’è©¦ã—ã¦ã¿ãŸã„ã§ã™...'
            }
        ],
        en: [
            {
                id: 'service_name',
                type: 'text',
                question: 'Which service are you switching to?',
                required: true,
                minLength: 2,
                placeholder: 'Enter the service name'
            },
            {
                id: 'what_attracted',
                type: 'radio',
                question: 'What attracted you to that service?',
                required: true,
                options: [
                    { value: 'lower_price', label: 'Lower price' },
                    { value: 'features', label: "Features we don't have" },
                    { value: 'schedule', label: 'Better schedule/format' },
                    { value: 'recommended', label: 'Recommended by friend' },
                    { value: 'marketing', label: 'Better marketing/trial experience' }
                ]
            },
            {
                id: 'wish_we_had',
                type: 'textarea',
                question: 'What do they offer that you wish we had?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., Group lessons, native speaker exchange, etc...'
            },
            {
                id: 'if_matched',
                type: 'radio',
                question: 'If we matched or exceeded their offer, would you stay?',
                required: true,
                options: [
                    { value: 'yes_prefer', label: 'Yes, I prefer Prokaiwa if pricing/features match' },
                    { value: 'maybe', label: "Maybe, I'd need to see the details" },
                    { value: 'no', label: 'No, I want to try something different' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about switching services?',
                required: true,
                minLength: 20,
                placeholder: 'e.g., I want to try something new...'
            }
        ]
    },

    circumstances: {
        ja: [
            {
                id: 'what_changed',
                type: 'radio',
                question: 'ç”Ÿæ´»çŠ¶æ³ã§ä½•ãŒå¤‰ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'lost_job', label: 'ä»•äº‹ã‚’å¤±ã£ãŸãƒ»çµŒæ¸ˆçš„å›°é›£' },
                    { value: 'new_job', label: 'æ–°ã—ã„ä»•äº‹ãƒ»å¿™ã—ã™ãã‚‹' },
                    { value: 'family', label: 'å®¶æ—ã®çŠ¶æ³ï¼ˆå‡ºç”£ã€ä»‹è­·ãªã©ï¼‰' },
                    { value: 'health', label: 'å¥åº·ä¸Šã®å•é¡Œ' },
                    { value: 'moving', label: 'å¼•ã£è¶Šã—ãƒ»è»¢å‹¤' },
                    { value: 'prefer_not_say', label: 'ç­”ãˆãŸããªã„' }
                ]
            },
            {
                id: 'temporary_or_longterm',
                type: 'radio',
                question: 'ã“ã®å¤‰åŒ–ã¯ä¸€æ™‚çš„ã§ã™ã‹ï¼Ÿé•·æœŸçš„ã§ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'temporary', label: 'ä¸€æ™‚çš„ï¼ˆæ•°é€±é–“ã€œæ•°ãƒ¶æœˆï¼‰' },
                    { value: 'uncertain', label: 'ã‚ã‹ã‚‰ãªã„' },
                    { value: 'permanent', label: 'æ°¸ç¶šçš„ãƒ»é•·æœŸçš„' }
                ]
            },
            {
                id: 'plan_to_continue',
                type: 'radio',
                question: 'ã„ãšã‚Œã¯è‹±èªå­¦ç¿’ã‚’å†é–‹ã™ã‚‹äºˆå®šã§ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes', label: 'ã¯ã„ã€çŠ¶æ³ãŒæ”¹å–„ã—ãŸã‚‰' },
                    { value: 'maybe', label: 'ãŸã¶ã‚“ã€ã‚ã‹ã‚‰ãªã„' },
                    { value: 'no', label: 'ã„ã„ãˆã€ä»Šã¯äººç”Ÿã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒåˆã‚ãªã„' }
                ]
            },
            {
                id: 'pause_instead',
                type: 'radio',
                question: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã¯ãªãã€ä¸€æ™‚åœæ­¢ã®æ–¹ãŒã„ã„ã§ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_1_3', label: 'ã¯ã„ã€1ã€œ3ãƒ¶æœˆåœæ­¢ã—ãŸã„' },
                    { value: 'maybe', label: 'ãŸã¶ã‚“ã€å†é–‹æ™‚æœŸãŒã‚ã‹ã‚‰ãªã„' },
                    { value: 'no', label: 'ã„ã„ãˆã€å®Œå…¨ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'çŠ¶æ³ã«ã¤ã„ã¦ã€ãã®ä»–ã®ã”æ„è¦‹ãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ä¾‹ï¼šä»Šã¯é›£ã—ã„æ™‚æœŸã§ã™ãŒ...'
            }
        ],
        en: [
            {
                id: 'what_changed',
                type: 'radio',
                question: 'What changed in your life?',
                required: true,
                options: [
                    { value: 'lost_job', label: 'Lost job / Financial hardship' },
                    { value: 'new_job', label: 'New job / Too busy with work' },
                    { value: 'family', label: 'Family situation (new baby, caring for family, etc.)' },
                    { value: 'health', label: 'Health issues' },
                    { value: 'moving', label: 'Moving/relocating' },
                    { value: 'prefer_not_say', label: 'Prefer not to say' }
                ]
            },
            {
                id: 'temporary_or_longterm',
                type: 'radio',
                question: 'Is this change temporary or long-term?',
                required: true,
                options: [
                    { value: 'temporary', label: 'Temporary (few weeks to few months)' },
                    { value: 'uncertain', label: 'Uncertain' },
                    { value: 'permanent', label: 'Permanent/long-term' }
                ]
            },
            {
                id: 'plan_to_continue',
                type: 'radio',
                question: 'Do you plan to continue English learning eventually?',
                required: true,
                options: [
                    { value: 'yes', label: 'Yes, when circumstances improve' },
                    { value: 'maybe', label: 'Maybe, not sure' },
                    { value: 'no', label: "No, this isn't the right time in my life" }
                ]
            },
            {
                id: 'pause_instead',
                type: 'radio',
                question: 'Would a pause option help instead of canceling?',
                required: true,
                options: [
                    { value: 'yes_1_3', label: 'Yes, I\'d like to pause for 1-3 months' },
                    { value: 'maybe', label: "Maybe, but I'm not sure when I'll resume" },
                    { value: 'no', label: 'No, I need to fully cancel right now' }
                ]
            },
            {
                id: 'additional_comments',
                type: 'textarea',
                question: 'Any other thoughts about your situation?',
                required: true,
                minLength: 20,
                placeholder: "e.g., It's a difficult time right now but..."
            }
        ]
    },

    other: {
        ja: [
            {
                id: 'reason_text',
                type: 'textarea',
                question: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ç†ç”±ã‚’æ•™ãˆã¦ãã ã•ã„',
                required: true,
                minLength: 20,
                placeholder: 'ã§ãã‚‹ã ã‘è©³ã—ãæ•™ãˆã¦ãã ã•ã„...'
            },
            {
                id: 'overall_rating',
                type: 'radio',
                question: 'å…¨ä½“çš„ãªä½“é¨“ã‚’è©•ä¾¡ã—ã¦ãã ã•ã„',
                required: true,
                options: [
                    { value: '5', label: 'â­â­â­â­â­ ç´ æ™´ã‚‰ã—ã„' },
                    { value: '4', label: 'â­â­â­â­ è‰¯ã„' },
                    { value: '3', label: 'â­â­â­ æ™®é€š' },
                    { value: '2', label: 'â­â­ ã„ã¾ã„ã¡' },
                    { value: '1', label: 'â­ æ‚ªã„' }
                ]
            },
            {
                id: 'could_have_done',
                type: 'textarea',
                question: 'ç§ãŸã¡ãŒã§ããŸã“ã¨ã¯ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ',
                required: false,
                minLength: 0,
                placeholder: 'ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ãŸã‚ã€ç‡ç›´ãªã”æ„è¦‹ã‚’ãŠèã‹ã›ãã ã•ã„...'
            },
            {
                id: 'would_recommend',
                type: 'radio',
                question: 'Prokaiwaã‚’ä»–ã®äººã«å‹§ã‚ã¾ã™ã‹ï¼Ÿ',
                required: true,
                options: [
                    { value: 'yes_definitely', label: 'ã¯ã„ã€çµ¶å¯¾ã«' },
                    { value: 'yes_with_reservations', label: 'ã¯ã„ã€æ¡ä»¶ä»˜ãã§' },
                    { value: 'neutral', label: 'ã©ã¡ã‚‰ã§ã‚‚ãªã„' },
                    { value: 'no', label: 'ã„ã„ãˆã€ãŸã¶ã‚“å‹§ã‚ãªã„' }
                ]
            }
        ],
        en: [
            {
                id: 'reason_text',
                type: 'textarea',
                question: 'Please tell us why you\'re canceling',
                required: true,
                minLength: 20,
                placeholder: 'Please be as detailed as possible...'
            },
            {
                id: 'overall_rating',
                type: 'radio',
                question: 'How would you rate your overall experience?',
                required: true,
                options: [
                    { value: '5', label: 'â­â­â­â­â­ Excellent' },
                    { value: '4', label: 'â­â­â­â­ Good' },
                    { value: '3', label: 'â­â­â­ Average' },
                    { value: '2', label: 'â­â­ Below Average' },
                    { value: '1', label: 'â­ Poor' }
                ]
            },
            {
                id: 'could_have_done',
                type: 'textarea',
                question: 'Is there anything we could have done differently?',
                required: false,
                minLength: 0,
                placeholder: 'Your honest feedback helps us improve...'
            },
            {
                id: 'would_recommend',
                type: 'radio',
                question: 'Would you recommend Prokaiwa to others?',
                required: true,
                options: [
                    { value: 'yes_definitely', label: 'Yes, definitely' },
                    { value: 'yes_with_reservations', label: 'Yes, with reservations' },
                    { value: 'neutral', label: 'Neutral' },
                    { value: 'no', label: 'No, probably not' }
                ]
            }
        ]
    }
};

// =====================================================
// UNIVERSAL QUESTIONS (Asked to Everyone)
// =====================================================

const universalQuestions = {
    ja: [
        {
            id: 'satisfaction_rating',
            type: 'rating',
            question: 'Prokaiwaã§ã®ä½“é¨“ã‚’5æ®µéšã§è©•ä¾¡ã—ã¦ãã ã•ã„',
            required: true
        },
        {
            id: 'would_recommend',
            type: 'radio',
            question: 'å‹äººã«Prokaiwaã‚’å‹§ã‚ã¾ã™ã‹ï¼Ÿ',
            required: true,
            options: [
                { value: 'yes_definitely', label: 'ã¯ã„ã€çµ¶å¯¾ã«' },
                { value: 'yes_maybe', label: 'ã¯ã„ã€ãŸã¶ã‚“' },
                { value: 'neutral', label: 'ã©ã¡ã‚‰ã§ã‚‚ãªã„' },
                { value: 'no', label: 'ã„ã„ãˆ' }
            ]
        },
        {
            id: 'what_could_improve',
            type: 'textarea',
            question: 'ã‚µãƒ¼ãƒ“ã‚¹æ”¹å–„ã®ãŸã‚ã€ç‡ç›´ãªã”æ„è¦‹ã‚’ãŠèã‹ã›ãã ã•ã„',
            required: false,
            minLength: 0,
            placeholder: 'ã‚ˆã‚Šè‰¯ã„ã‚µãƒ¼ãƒ“ã‚¹ã«ã™ã‚‹ãŸã‚ã€ã‚ãªãŸã®ã”æ„è¦‹ã‚’ãŠèã‹ã›ãã ã•ã„...'
        }
    ],
    en: [
        {
            id: 'satisfaction_rating',
            type: 'rating',
            question: 'How would you rate your experience with Prokaiwa?',
            required: true
        },
        {
            id: 'would_recommend',
            type: 'radio',
            question: 'Would you recommend Prokaiwa to a friend?',
            required: true,
            options: [
                { value: 'yes_definitely', label: 'Yes, definitely' },
                { value: 'yes_maybe', label: 'Yes, probably' },
                { value: 'neutral', label: 'Neutral' },
                { value: 'no', label: 'No' }
            ]
        },
        {
            id: 'what_could_improve',
            type: 'textarea',
            question: 'What could we do better?',
            required: false,
            minLength: 0,
            placeholder: 'Your honest feedback helps us improve...'
        }
    ]
};

// =====================================================
// RETENTION OFFERS (Based on Reason + Answers)
// =====================================================

const retentionOffers = {
    expensive: {
        ja: {
            downgrade: {
                title: 'ğŸ’¡ ãŠå¾…ã¡ãã ã•ã„ï¼',
                subtitle: 'ã‚ˆã‚Šæ‰‹é ƒãªãƒ—ãƒ©ãƒ³ã‚’ã”ç”¨æ„ã—ã¾ã—ãŸ',
                description: 'æ¯æ—¥ã®ç·´ç¿’ã¯ç¶­æŒã—ãªãŒã‚‰ã€æ–™é‡‘ã‚’æŠ‘ãˆãŸãƒ—ãƒ©ãƒ³Aã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¾ã›ã‚“ã‹ï¼Ÿ',
                features: [
                    'æ¯æ—¥ã®LINEç·´ç¿’ï¼ˆå¤‰ã‚ã‚‰ãšï¼‰',
                    'é€±1å›ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯',
                    'æœˆé¡Â¥4,500ï¼ˆÂ¥2,500ãŠå¾—ï¼‰'
                ],
                primaryAction: {
                    text: 'ãƒ—ãƒ©ãƒ³Aã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰',
                    type: 'downgrade',
                    data: { newPlan: 'A' }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            },
            discount: {
                title: 'âœ¨ ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼',
                subtitle: '3ãƒ¶æœˆé–“20%å‰²å¼•',
                description: 'ç¶™ç¶šã—ã¦ã„ãŸã ããŸã‚ã€ä»Šå¾Œ3ãƒ¶æœˆé–“20%å‰²å¼•ã‚’é©ç”¨ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚',
                features: [
                    'ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³ãã®ã¾ã¾',
                    'ä»Šå¾Œ3ãƒ¶æœˆé–“20%ã‚ªãƒ•',
                    'æœˆé¡Â¥5,600ï¼ˆé€šå¸¸Â¥7,000ï¼‰'
                ],
                primaryAction: {
                    text: 'å‰²å¼•ã‚’åˆ©ç”¨ã™ã‚‹',
                    type: 'discount',
                    data: { couponCode: 'RETAIN_20PCT_3MO' }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            downgrade: {
                title: 'ğŸ’¡ Wait! We Have a Solution',
                subtitle: "A more affordable plan that still helps you improve",
                description: "Keep your daily practice but save money with Plan A - all the core features at a lower price.",
                features: [
                    'Daily LINE practice (unchanged)',
                    'Weekly feedback from teachers',
                    'Â¥4,500/month (Save Â¥2,500)'
                ],
                primaryAction: {
                    text: 'Switch to Plan A',
                    type: 'downgrade',
                    data: { newPlan: 'A' }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            },
            discount: {
                title: 'âœ¨ Special Offer for You',
                subtitle: '20% off for 3 months',
                description: "We'd love to keep you as a student. Accept this 20% discount for the next 3 months.",
                features: [
                    'Keep your current plan',
                    '20% off for 3 months',
                    'Â¥5,600/month (normally Â¥7,000)'
                ],
                primaryAction: {
                    text: 'Accept Discount',
                    type: 'discount',
                    data: { couponCode: 'RETAIN_20PCT_3MO' }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    not_using: {
        ja: {
            pause: {
                title: 'â¸ï¸ ä¸€æ™‚åœæ­¢ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ',
                subtitle: 'ä»Šã¯ä¼‘ã‚“ã§ã€æº–å‚™ãŒã§ããŸã‚‰å†é–‹',
                description: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã¯ãªãã€1ã€œ3ãƒ¶æœˆé–“ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã›ã‚“ã‹ï¼Ÿ',
                features: [
                    'æ–™é‡‘ã¯ä¸€æ™‚åœæ­¢ä¸­ã‹ã‹ã‚Šã¾ã›ã‚“',
                    'é€²æ—ã¨ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã¯ä¿å­˜ã•ã‚Œã¾ã™',
                    'æº–å‚™ãŒã§ããŸã‚‰ã„ã¤ã§ã‚‚å†é–‹å¯èƒ½'
                ],
                primaryAction: {
                    text: 'ä¸€æ™‚åœæ­¢ã™ã‚‹',
                    type: 'pause',
                    data: { pauseMonths: 2 }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            pause: {
                title: 'â¸ï¸ How About a Pause Instead?',
                subtitle: 'Take a break now, resume when ready',
                description: "Instead of canceling, why not pause your subscription for 1-3 months? No charges while paused.",
                features: [
                    'No charges while paused',
                    'Your progress and credits are saved',
                    'Resume anytime when ready'
                ],
                primaryAction: {
                    text: 'Pause Subscription',
                    type: 'pause',
                    data: { pauseMonths: 2 }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    too_difficult: {
        ja: {
            consultation: {
                title: 'ğŸ¯ ç„¡æ–™ç›¸è«‡ã‚’ã”åˆ©ç”¨ãã ã•ã„',
                subtitle: 'ã‚ãªãŸã«æœ€é©ãªå­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ä½œã‚Šã¾ã—ã‚‡ã†',
                description: 'è¬›å¸«ã¨ã®ç„¡æ–™30åˆ†ç›¸è«‡ã§ã€ã‚ãªãŸã®ãƒ¬ãƒ™ãƒ«ã«åˆã£ãŸå­¦ç¿’ãƒ—ãƒ©ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚',
                features: [
                    '30åˆ†ã®ç„¡æ–™ãƒãƒ³ãƒ„ãƒ¼ãƒãƒ³ç›¸è«‡',
                    'ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå­¦ç¿’ãƒ—ãƒ©ãƒ³',
                    'ã‚ˆã‚Šç°¡å˜ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹'
                ],
                primaryAction: {
                    text: 'ç›¸è«‡ã‚’äºˆç´„ã™ã‚‹',
                    type: 'consultation',
                    data: { freeConsultation: true }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            consultation: {
                title: 'ğŸ¯ Let Us Help You Succeed',
                subtitle: "Free consultation to create your perfect learning plan",
                description: "Book a free 30-minute session with a teacher to customize content for your level.",
                features: [
                    'Free 30-minute one-on-one consultation',
                    'Personalized learning plan',
                    'Access to beginner-friendly content'
                ],
                primaryAction: {
                    text: 'Book Free Consultation',
                    type: 'consultation',
                    data: { freeConsultation: true }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    too_easy: {
        ja: {
            waitlist: {
                title: 'ğŸš€ ä¸Šç´šè€…å‘ã‘ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é–‹ç™ºä¸­',
                subtitle: 'ã‚ãªãŸã®ã‚ˆã†ãªå­¦ç¿’è€…ã®ãŸã‚ã«æº–å‚™ä¸­ã§ã™',
                description: 'ã‚ˆã‚Šé«˜åº¦ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é–‹ç™ºä¸­ã§ã™ã€‚ã‚¦ã‚§ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å‚åŠ ã—ã¦ã€æº–å‚™ãŒã§ããŸã‚‰ã™ãã«ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚',
                features: [
                    'ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ»æ™‚äº‹å•é¡Œã®è­°è«–',
                    'ãƒ“ã‚¸ãƒã‚¹è‹±èªã‚·ãƒŠãƒªã‚ª',
                    'é«˜åº¦ãªæ–‡æ³•ã¨èªå½™',
                    'ã‚¦ã‚§ã‚¤ãƒˆãƒªã‚¹ãƒˆå‚åŠ è€…é™å®š50%å‰²å¼•'
                ],
                primaryAction: {
                    text: 'ã‚¦ã‚§ã‚¤ãƒˆãƒªã‚¹ãƒˆã«å‚åŠ ',
                    type: 'waitlist',
                    data: { waitlistType: 'advanced_content' }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            waitlist: {
                title: 'ğŸš€ Advanced Content Coming Soon',
                subtitle: "We're building it for learners like you",
                description: "We're developing more challenging content. Join our waitlist and we'll notify you as soon as it's ready.",
                features: [
                    'Real-world news discussions',
                    'Business English scenarios',
                    'Advanced grammar & vocabulary',
                    '50% discount for waitlist members'
                ],
                primaryAction: {
                    text: 'Join Waitlist',
                    type: 'waitlist',
                    data: { waitlistType: 'advanced_content' }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    scheduling: {
        ja: {
            pause: {
                title: 'â¸ï¸ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè½ã¡ç€ãã¾ã§ä¸€æ™‚åœæ­¢',
                subtitle: 'ä»Šã¯ä¼‘ã‚“ã§ã€æ™‚é–“ãŒã§ããŸã‚‰å†é–‹',
                description: 'å¿™ã—ã„æ™‚æœŸã¯ä¸€æ™‚åœæ­¢ã—ã¦ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè½ã¡ç€ã„ãŸã‚‰å†é–‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ',
                features: [
                    'ä¸€æ™‚åœæ­¢ä¸­ã¯æ–™é‡‘ãªã—',
                    'é€²æ—ã¯ä¿å­˜ã•ã‚Œã¾ã™',
                    'ã„ã¤ã§ã‚‚å†é–‹å¯èƒ½'
                ],
                primaryAction: {
                    text: 'ä¸€æ™‚åœæ­¢ã™ã‚‹',
                    type: 'pause',
                    data: { pauseMonths: 2 }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            pause: {
                title: 'â¸ï¸ Pause Until Your Schedule Clears',
                subtitle: 'Take a break now, resume when you have time',
                description: "Pause during this busy period and resume when your schedule allows.",
                features: [
                    'No charges while paused',
                    'Your progress is saved',
                    'Resume anytime'
                ],
                primaryAction: {
                    text: 'Pause Subscription',
                    type: 'pause',
                    data: { pauseMonths: 2 }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    technical: {
        ja: {
            support: {
                title: 'ğŸ”§ æŠ€è¡“ã‚µãƒãƒ¼ãƒˆã«ãŠä»»ã›ãã ã•ã„',
                subtitle: 'å•é¡Œã‚’è§£æ±ºã™ã‚‹ã¾ã§ç„¡æ–™ã§å»¶é•·',
                description: 'æŠ€è¡“çš„ãªå•é¡Œã¯ç§ãŸã¡ã®è²¬ä»»ã§ã™ã€‚å•é¡Œã‚’è§£æ±ºã™ã‚‹ã¾ã§ã€1ãƒ¶æœˆç„¡æ–™ã§å»¶é•·ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚',
                features: [
                    'å„ªå…ˆæŠ€è¡“ã‚µãƒãƒ¼ãƒˆ',
                    'å•é¡Œè§£æ±ºã¾ã§1ãƒ¶æœˆç„¡æ–™',
                    'å°‚ä»»ã‚µãƒãƒ¼ãƒˆæ‹…å½“è€…'
                ],
                primaryAction: {
                    text: 'ã‚µãƒãƒ¼ãƒˆã‚’å—ã‘ã‚‹',
                    type: 'technical_support',
                    data: { freeMonth: true, prioritySupport: true }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            support: {
                title: 'ğŸ”§ Let Our Support Team Fix This',
                subtitle: 'Free month while we resolve your issues',
                description: "Technical problems are on us. We'll give you a free month while we fix everything.",
                features: [
                    'Priority technical support',
                    '1 month free while we fix issues',
                    'Dedicated support representative'
                ],
                primaryAction: {
                    text: 'Get Support',
                    type: 'technical_support',
                    data: { freeMonth: true, prioritySupport: true }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    goals_met: {
        ja: {
            alumni: {
                title: 'ğŸ“ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚¢ãƒ«ãƒ ãƒŠã‚¤ã«ãªã‚Šã¾ã›ã‚“ã‹',
                subtitle: 'ä»Šå¾Œã„ã¤ã§ã‚‚50%å‰²å¼•ã§æˆ»ã‚Œã¾ã™',
                description: 'ç›®æ¨™é”æˆã€ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼ã‚¢ãƒ«ãƒ ãƒŠã‚¤ã«ãªã‚‹ã¨ã€ã„ã¤ã§ã‚‚50%å‰²å¼•ã§æˆ»ã£ã¦ã“ã‚‰ã‚Œã¾ã™ã€‚',
                features: [
                    'ç”Ÿæ¶¯æœ‰åŠ¹ã®50%å‰²å¼•ã‚³ãƒ¼ãƒ‰',
                    'ã„ã¤ã§ã‚‚å†é–‹å¯èƒ½',
                    'ã‚¢ãƒ«ãƒ ãƒŠã‚¤é™å®šã®æ–°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®æ—©æœŸã‚¢ã‚¯ã‚»ã‚¹'
                ],
                primaryAction: {
                    text: 'ã‚¢ãƒ«ãƒ ãƒŠã‚¤ã«ãªã‚‹',
                    type: 'alumni',
                    data: { alumniDiscount: 50 }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            alumni: {
                title: 'ğŸ“ Congratulations! Become an Alumni',
                subtitle: 'Come back anytime with 50% off',
                description: "You achieved your goals - amazing! Become an alumni and get 50% off whenever you return.",
                features: [
                    'Lifetime 50% discount code',
                    'Return anytime',
                    'Early access to new alumni-exclusive content'
                ],
                primaryAction: {
                    text: 'Become Alumni',
                    type: 'alumni',
                    data: { alumniDiscount: 50 }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    switching: {
        ja: {
            match: {
                title: 'ğŸ¤ ç«¶åˆä»–ç¤¾ã®ã‚ªãƒ•ã‚¡ãƒ¼ã«å¯¾æŠ—ã—ã¾ã™',
                subtitle: 'åŒç­‰ä»¥ä¸Šã®æ¡ä»¶ã‚’ã”ææ¡ˆ',
                description: 'ä»–ç¤¾ã®æ¡ä»¶ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€ãã‚Œã«è¦‹åˆã†ã‹ä¸Šå›ã‚‹ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚',
                features: [
                    'ä¾¡æ ¼ãƒãƒƒãƒãƒ³ã‚°',
                    'è¿½åŠ æ©Ÿèƒ½ã®æä¾›',
                    'Prokaiwaãªã‚‰ã§ã¯ã®ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ã‚µãƒãƒ¼ãƒˆ'
                ],
                primaryAction: {
                    text: 'æ¡ä»¶ã‚’ç›¸è«‡ã™ã‚‹',
                    type: 'consultation',
                    data: { matchCompetitor: true }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            match: {
                title: "ğŸ¤ We'll Match Their Offer",
                subtitle: 'Get equivalent or better terms',
                description: "Tell us about their offer and we'll match or beat it with added Prokaiwa benefits.",
                features: [
                    'Price matching',
                    'Additional features included',
                    'Personalized support only Prokaiwa offers'
                ],
                primaryAction: {
                    text: 'Discuss Terms',
                    type: 'consultation',
                    data: { matchCompetitor: true }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    },
    
    circumstances: {
        ja: {
            pause: {
                title: 'ğŸ¤— ç„¡ç†ã›ãšä¸€æ™‚åœæ­¢ã—ã¦ãã ã•ã„',
                subtitle: 'æº–å‚™ãŒã§ããŸã‚‰ã€ã„ã¤ã§ã‚‚æˆ»ã£ã¦ãã¦ãã ã•ã„',
                description: 'ä»Šã¯å¤§å¤‰ãªæ™‚æœŸã§ã™ã­ã€‚ä¸€æ™‚åœæ­¢ã—ã¦ã€è½ã¡ç€ã„ãŸã‚‰å†é–‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ',
                features: [
                    'æœ€å¤§6ãƒ¶æœˆé–“ã®ä¸€æ™‚åœæ­¢',
                    'ä¸€æ™‚åœæ­¢ä¸­ã¯æ–™é‡‘ãªã—',
                    'é€²æ—ã¨ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã¯ä¿å­˜',
                    'æº–å‚™ãŒã§ããŸã‚‰ã„ã¤ã§ã‚‚å†é–‹'
                ],
                primaryAction: {
                    text: 'ä¸€æ™‚åœæ­¢ã™ã‚‹',
                    type: 'pause',
                    data: { pauseMonths: 3 }
                },
                secondaryAction: {
                    text: 'ã„ã„ãˆã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™',
                    type: 'decline'
                }
            }
        },
        en: {
            pause: {
                title: "ğŸ¤— Take Care of Yourself - We'll Be Here",
                subtitle: 'Come back when you\'re ready',
                description: "Life happens. Pause your subscription and resume when things settle down.",
                features: [
                    'Pause for up to 6 months',
                    'No charges while paused',
                    'Progress and credits saved',
                    'Resume anytime when ready'
                ],
                primaryAction: {
                    text: 'Pause Subscription',
                    type: 'pause',
                    data: { pauseMonths: 3 }
                },
                secondaryAction: {
                    text: 'No, cancel my subscription',
                    type: 'decline'
                }
            }
        }
    }
};

// =====================================================
// STATE MANAGEMENT
// =====================================================

const cancellationState = {
    currentLang: 'ja',
    currentStep: 'reason',
    selectedReason: null,
    questionAnswers: {},
    universalAnswers: {},
    offerShown: null,
    offerType: null,
    offerDecision: null,
    offerAccepted: false,
    userData: {
        userId: null,
        studentId: null,
        currentPlan: null,
        subscriptionId: null
    }
};

// =====================================================
// OFFER DECISION LOGIC
// =====================================================

function determineOffer(reason, answers, lang) {
    console.log('ğŸ¯ Determining offer for:', { reason, answers });
    
    switch(reason) {
        case 'expensive':
            // If they said they'd stay for affordable option
            if (answers.stay_if_affordable === 'yes_definitely' || 
                answers.stay_if_affordable === 'yes_depending') {
                // If they selected reasonable price under current plan
                const reasonablePrice = answers.reasonable_price;
                if (reasonablePrice === 'under_3000' || reasonablePrice === '3000_4000') {
                    return { type: 'downgrade', offer: retentionOffers.expensive[lang].downgrade };
                } else {
                    return { type: 'discount', offer: retentionOffers.expensive[lang].discount };
                }
            }
            return null;
            
        case 'not_using':
            // If they would use it more with changes OR reason is "too busy"
            if (answers.what_would_help !== 'nothing_helps' || 
                answers.reason_not_using === 'too_busy') {
                return { type: 'pause', offer: retentionOffers.not_using[lang].pause };
            }
            return null;
            
        case 'too_difficult':
            // If they haven't reached out for help or would benefit from support
            if (answers.what_would_help === 'one_on_one' || 
                answers.reached_out_for_help === 'no_didnt_know' ||
                answers.reached_out_for_help === 'yes_still_struggled') {
                return { type: 'consultation', offer: retentionOffers.too_difficult[lang].consultation };
            }
            return null;
            
        case 'too_easy':
            // If they still want to improve in some areas
            if (answers.stay_for_advanced === 'yes_if_challenging' ||
                answers.stay_for_advanced === 'maybe_depending') {
                return { type: 'waitlist', offer: retentionOffers.too_easy[lang].waitlist };
            }
            return null;
            
        case 'scheduling':
            // If it's work conflicts or temporary
            if (answers.what_would_solve === 'pause' ||
                answers.scheduling_issue === 'work_conflicts' ||
                answers.scheduling_issue === 'irregular_schedule') {
                return { type: 'pause', offer: retentionOffers.scheduling[lang].pause };
            }
            return null;
            
        case 'technical':
            // If problems were frequent and impactful
            if (answers.problem_frequency === 'constantly' || 
                answers.problem_frequency === 'frequently' ||
                answers.impact_on_experience === 'unusable' ||
                answers.impact_on_experience === 'very_frustrating') {
                return { type: 'technical_support', offer: retentionOffers.technical[lang].support };
            }
            return null;
            
        case 'goals_met':
            // If they might need to maintain or have ongoing needs
            if (answers.use_maintenance === 'yes_avoid_losing' ||
                answers.use_maintenance === 'maybe_if_affordable' ||
                answers.ongoing_needs === 'maintain') {
                return { type: 'alumni', offer: retentionOffers.goals_met[lang].alumni };
            }
            return null;
            
        case 'switching':
            // If they would stay if we matched
            if (answers.if_matched === 'yes_prefer' || answers.if_matched === 'maybe') {
                return { type: 'consultation', offer: retentionOffers.switching[lang].match };
            }
            return null;
            
        case 'circumstances':
            // If it's temporary
            if (answers.temporary_or_longterm === 'temporary' ||
                answers.temporary_or_longterm === 'uncertain' ||
                answers.pause_instead === 'yes_1_3' ||
                answers.pause_instead === 'maybe') {
                return { type: 'pause', offer: retentionOffers.circumstances[lang].pause };
            }
            return null;
            
        default:
            return null;
    }
}

// =====================================================
// INITIALIZATION
// =====================================================

async function initCancellationFlow() {
    console.log('ğŸ¯ Initializing cancellation flow...');
    
    // Check authentication
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
        console.error('âŒ Not authenticated');
        window.location.href = 'login.html';
        return;
    }
    
    cancellationState.userData.userId = user.id;
    
    // Get user's subscription data
    try {
        const { data: userData, error } = await supabase
    .from('questionnaire_responses')
    .select('id, plan, stripe_subscription_id')
    .eq('user_id', user.id)
    .single();
            
        if (error) throw error;
        
        cancellationState.userData.studentId = userData.id;
        cancellationState.userData.currentPlan = userData.plan;
        cancellationState.userData.subscriptionId = userData.stripe_subscription_id;
        
        console.log('âœ… User data loaded:', cancellationState.userData);
        
    } catch (error) {
        console.error('âŒ Error loading user data:', error);
        alert('Error loading your subscription data. Please try again.');
        return;
    }
    
    // Get language preference
    const savedLang = localStorage.getItem('prokaiwa-lang') || 'ja';
    cancellationState.currentLang = savedLang;
    
    // Render initial state
    renderCurrentStep();
    updateLanguageDisplay(savedLang);
}
        
// =====================================================
// MAKE FUNCTIONS GLOBALLY ACCESSIBLE FOR ONCLICK HANDLERS
// =====================================================

window.selectReason = selectReason;
window.proceedToDetails = proceedToDetails;
window.goBack = goBack;
window.proceedToOfferOrConfirm = proceedToOfferOrConfirm;
window.selectRadio = selectRadio;
window.toggleCheckbox = toggleCheckbox;
window.handleTextInput = handleTextInput;
window.setRating = setRating;
window.acceptOffer = acceptOffer;
window.declineOffer = declineOffer;
window.confirmCancellation = confirmCancellation;
        
// =====================================================
// RENDER FUNCTIONS
// =====================================================

function renderCurrentStep() {
    const lang = cancellationState.currentLang;
    const step = cancellationState.currentStep;
    
    console.log('ğŸ¨ Rendering step:', step, 'lang:', lang);
    
    // Update step indicators
    updateStepIndicators(lang, step);
    
    // Render appropriate content
    switch(step) {
    case 'reason':
        renderReasonSelection(lang);
        break;
    case 'details':
        renderQuestionForm(lang);
        break;
    case 'offer':
        renderOffer(lang, cancellationState.offerDecision);
        break;
    case 'confirm':
        renderConfirmation(lang);
        break;
}
}

function updateStepIndicators(lang, currentStep) {
    const steps = ['reason', 'details', 'confirm'];
    const stepMap = { reason: 1, details: 2, offer: 2.5, confirm: 3 };
    const currentStepNum = stepMap[currentStep];
    
    steps.forEach((step, index) => {
        const stepNum = index + 1;
        const stepEl = document.getElementById(`${lang}-step${stepNum}`);
        
        if (!stepEl) return;
        
        stepEl.classList.remove('active', 'completed');
        
        if (stepNum < currentStepNum) {
            stepEl.classList.add('completed');
        } else if (stepNum === Math.floor(currentStepNum)) {
            stepEl.classList.add('active');
        }
    });
}

function renderReasonSelection(lang) {
    const gridEl = document.getElementById(`${lang}-reason-grid`);
    if (!gridEl) return;
    
    const reasons = cancellationReasons[lang];
    
    gridEl.innerHTML = reasons.map(reason => `
        <div class="reason-option" data-reason="${reason.id}" onclick="selectReason('${lang}', '${reason.id}')">
            <div class="reason-icon">${reason.icon}</div>
            <div class="reason-content">
                <div class="reason-title">${reason.title}</div>
                <div class="reason-subtitle">${reason.subtitle}</div>
            </div>
        </div>
    `).join('');
    
    // Show reason section, hide others
    document.getElementById(`${lang}-section-reason`).classList.add('active');
    document.getElementById(`${lang}-section-details`).classList.remove('active');
    document.getElementById(`${lang}-section-offer`).classList.remove('active');
    document.getElementById(`${lang}-section-confirm`).classList.remove('active');
}

function renderQuestionForm(lang) {
    const reason = cancellationState.selectedReason;
    const formEl = document.getElementById(`${lang}-question-form`);
    const titleEl = document.getElementById(`${lang}-details-title`);
    
    if (!formEl || !titleEl) return;
    
    // Get reason-specific questions
    const questions = reasonQuestions[reason]?.[lang] || [];
    
    // Update title
    titleEl.textContent = lang === 'ja' ? 'è©³ã—ãæ•™ãˆã¦ãã ã•ã„' : 'Tell us more';
    
    // Render questions
    formEl.innerHTML = questions.map(q => renderQuestion(q, lang)).join('');
    
    // Add universal questions at the end
    const universalQs = universalQuestions[lang];
    formEl.innerHTML += '<div style="border-top: 2px solid var(--color-border); margin: 2rem 0; padding-top: 2rem;"></div>';
    formEl.innerHTML += universalQs.map(q => renderQuestion(q, lang)).join('');
    
    // Show details section
    document.getElementById(`${lang}-section-reason`).classList.remove('active');
    document.getElementById(`${lang}-section-details`).classList.add('active');
    document.getElementById(`${lang}-section-offer`).classList.remove('active');
    document.getElementById(`${lang}-section-confirm`).classList.remove('active');
}

function renderQuestion(question, lang) {
    const qId = question.id;
    const currentAnswer = cancellationState.questionAnswers[qId] || 
                         cancellationState.universalAnswers[qId];
    
    switch(question.type) {
        case 'radio':
            return `
                <div class="question-group">
                    <div class="question-label">${question.question}${question.required ? ' *' : ''}</div>
                    <div class="question-options">
                        ${question.options.map(opt => `
                            <div class="radio-option ${currentAnswer === opt.value ? 'selected' : ''}" 
                                 onclick="selectRadio('${qId}', '${opt.value}')">
                                <input type="radio" name="${qId}" value="${opt.value}" 
                                       ${currentAnswer === opt.value ? 'checked' : ''}>
                                <label>${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    ${question.required ? '<div class="validation-message" id="val-' + qId + '">Please select an option</div>' : ''}
                </div>
            `;
            
        case 'checkbox':
            const checkedValues = currentAnswer || [];
            return `
                <div class="question-group">
                    <div class="question-label">${question.question}${question.required ? ' *' : ''}</div>
                    <div class="question-options">
                        ${question.options.map(opt => `
                            <div class="checkbox-option ${checkedValues.includes(opt.value) ? 'selected' : ''}"
                                 onclick="toggleCheckbox('${qId}', '${opt.value}')">
                                <input type="checkbox" value="${opt.value}" 
                                       ${checkedValues.includes(opt.value) ? 'checked' : ''}>
                                <label>${opt.label}</label>
                            </div>
                        `).join('')}
                    </div>
                    ${question.required ? '<div class="validation-message" id="val-' + qId + '">Please select at least one option</div>' : ''}
                </div>
            `;
            
        case 'text':
            return `
                <div class="question-group">
                    <div class="question-label">${question.question}${question.required ? ' *' : ''}</div>
                    <input type="text" 
                           class="text-input" 
                           id="input-${qId}"
                           placeholder="${question.placeholder || ''}"
                           value="${currentAnswer || ''}"
                           oninput="handleTextInput('${qId}', this.value, ${question.minLength || 0})"
                           ${question.required ? 'required' : ''}>
                    ${question.minLength ? `<div class="char-counter" id="counter-${qId}">0 / ${question.minLength} characters minimum</div>` : ''}
                    ${question.required ? '<div class="validation-message" id="val-' + qId + '">This field is required</div>' : ''}
                </div>
            `;
            
        case 'textarea':
            return `
                <div class="question-group">
                    <div class="question-label">${question.question}${question.required ? ' *' : ''}</div>
                    <textarea class="textarea-input" 
                              id="input-${qId}"
                              placeholder="${question.placeholder || ''}"
                              oninput="handleTextInput('${qId}', this.value, ${question.minLength || 0})"
                              ${question.required ? 'required' : ''}>${currentAnswer || ''}</textarea>
                    ${question.minLength ? `<div class="char-counter" id="counter-${qId}">0 / ${question.minLength} characters minimum</div>` : ''}
                    ${question.required ? '<div class="validation-message" id="val-' + qId + '">This field is required (min ' + question.minLength + ' chars)</div>' : ''}
                </div>
            `;
            
        case 'rating':
            const rating = currentAnswer || 0;
            return `
                <div class="question-group">
                    <div class="question-label">${question.question}${question.required ? ' *' : ''}</div>
                    <div class="rating-stars" id="rating-${qId}">
                        ${[1,2,3,4,5].map(star => `
                            <i class="fas fa-star ${star <= rating ? 'active' : ''}" 
                               onclick="setRating('${qId}', ${star})"
                               style="font-size: 2rem; cursor: pointer; color: ${star <= rating ? '#ffc107' : '#ddd'}; margin: 0 0.25rem;"></i>
                        `).join('')}
                    </div>
                    ${question.required ? '<div class="validation-message" id="val-' + qId + '">Please select a rating</div>' : ''}
                </div>
            `;
            
        default:
            return '';
    }
}

// CONTINUED IN NEXT MESSAGE...
console.log('âœ… Part 2A loaded: Universal questions, offers, state, render functions');
// =====================================================
// PART 2B: INPUT HANDLERS, NAVIGATION, VALIDATION, API
// =====================================================

// =====================================================
// INPUT HANDLERS
// =====================================================

function selectReason(lang, reasonId) {
    console.log('ğŸ“ Reason selected:', reasonId);
    
    // Remove selection from all reasons
    document.querySelectorAll(`#${lang}-reason-grid .reason-option`).forEach(el => {
        el.classList.remove('selected');
    });
    
    // Add selection to clicked reason
    const selectedEl = document.querySelector(`#${lang}-reason-grid .reason-option[data-reason="${reasonId}"]`);
    if (selectedEl) {
        selectedEl.classList.add('selected');
    }
    
    // Update state
    cancellationState.selectedReason = reasonId;
    
    // Enable continue button
    const continueBtn = document.getElementById(`${lang}-btn-continue-step1`);
    if (continueBtn) {
        continueBtn.disabled = false;
    }
}

function selectRadio(questionId, value) {
    console.log('ğŸ“ Radio selected:', questionId, value);
    
    // Store in appropriate state object
    if (universalQuestions.ja.some(q => q.id === questionId) || 
        universalQuestions.en.some(q => q.id === questionId)) {
        cancellationState.universalAnswers[questionId] = value;
    } else {
        cancellationState.questionAnswers[questionId] = value;
    }
    
    // Update UI - remove all selections, add to clicked
    const name = questionId;
    document.querySelectorAll(`input[name="${name}"]`).forEach(input => {
        const parent = input.closest('.radio-option');
        if (parent) {
            parent.classList.remove('selected');
        }
    });
    
    const clickedInput = document.querySelector(`input[name="${name}"][value="${value}"]`);
    if (clickedInput) {
        clickedInput.checked = true;
        const parent = clickedInput.closest('.radio-option');
        if (parent) {
            parent.classList.add('selected');
        }
    }
    
    // Hide validation message
    const valMsg = document.getElementById(`val-${questionId}`);
    if (valMsg) {
        valMsg.classList.remove('show');
    }
}

function toggleCheckbox(questionId, value) {
    console.log('ğŸ“ Checkbox toggled:', questionId, value);
    
    // Get current values
    let currentValues = cancellationState.questionAnswers[questionId] || [];
    
    // Toggle value
    if (currentValues.includes(value)) {
        currentValues = currentValues.filter(v => v !== value);
    } else {
        currentValues.push(value);
    }
    
    // Store updated values
    cancellationState.questionAnswers[questionId] = currentValues;
    
    // Update UI
    const checkbox = document.querySelector(`input[type="checkbox"][value="${value}"]`);
    if (checkbox) {
        checkbox.checked = currentValues.includes(value);
        const parent = checkbox.closest('.checkbox-option');
        if (parent) {
            if (currentValues.includes(value)) {
                parent.classList.add('selected');
            } else {
                parent.classList.remove('selected');
            }
        }
    }
    
    // Hide validation message if at least one selected
    if (currentValues.length > 0) {
        const valMsg = document.getElementById(`val-${questionId}`);
        if (valMsg) {
            valMsg.classList.remove('show');
        }
    }
}

function handleTextInput(questionId, value, minLength) {
    // Store in appropriate state object
    if (universalQuestions.ja.some(q => q.id === questionId) || 
        universalQuestions.en.some(q => q.id === questionId)) {
        cancellationState.universalAnswers[questionId] = value;
    } else {
        cancellationState.questionAnswers[questionId] = value;
    }
    
    // Update character counter
    const counter = document.getElementById(`counter-${questionId}`);
    if (counter && minLength > 0) {
        const currentLength = value.length;
        counter.textContent = `${currentLength} / ${minLength} characters minimum`;
        
        if (currentLength >= minLength) {
            counter.classList.add('valid');
            counter.classList.remove('invalid');
        } else if (currentLength > 0) {
            counter.classList.remove('valid');
            counter.classList.add('invalid');
        } else {
            counter.classList.remove('valid', 'invalid');
        }
    }
    
    // Hide validation message if valid
    if (value.length >= minLength) {
        const valMsg = document.getElementById(`val-${questionId}`);
        if (valMsg) {
            valMsg.classList.remove('show');
        }
    }
}

function setRating(questionId, stars) {
    console.log('â­ Rating set:', questionId, stars);
    
    cancellationState.universalAnswers[questionId] = stars;
    
    // Update star display
    const ratingEl = document.getElementById(`rating-${questionId}`);
    if (ratingEl) {
        const starEls = ratingEl.querySelectorAll('.fa-star');
        starEls.forEach((star, index) => {
            if (index < stars) {
                star.classList.add('active');
                star.style.color = '#ffc107';
            } else {
                star.classList.remove('active');
                star.style.color = '#ddd';
            }
        });
    }
    
    // Hide validation message
    const valMsg = document.getElementById(`val-${questionId}`);
    if (valMsg) {
        valMsg.classList.remove('show');
    }
}

// =====================================================
// VALIDATION
// =====================================================

function validateStep(step, lang) {
    console.log('âœ“ Validating step:', step);
    
    switch(step) {
        case 'reason':
            if (!cancellationState.selectedReason) {
                alert(lang === 'ja' ? 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„' : 'Please select a cancellation reason');
                return false;
            }
            return true;
            
        case 'details':
            return validateQuestions(lang);
            
        default:
            return true;
    }
}

function validateQuestions(lang) {
    const reason = cancellationState.selectedReason;
    
    // Get all questions for this reason + universal
    const reasonQs = reasonQuestions[reason]?.[lang] || [];
    const universalQs = universalQuestions[lang];
    const allQuestions = [...reasonQs, ...universalQs];
    
    let isValid = true;
    let firstInvalidId = null;
    
    allQuestions.forEach(q => {
        const answer = cancellationState.questionAnswers[q.id] || 
                      cancellationState.universalAnswers[q.id];
        const valMsg = document.getElementById(`val-${q.id}`);
        
        // Check if required field is empty
        if (q.required) {
            let fieldValid = false;
            
            if (q.type === 'checkbox') {
                fieldValid = answer && Array.isArray(answer) && answer.length > 0;
            } else if (q.type === 'text' || q.type === 'textarea') {
                const minLen = q.minLength || 0;
                fieldValid = answer && answer.length >= minLen;
            } else if (q.type === 'rating') {
                fieldValid = answer && answer > 0;
            } else {
                fieldValid = !!answer;
            }
            
            if (!fieldValid) {
                isValid = false;
                if (valMsg) {
                    valMsg.classList.add('show');
                }
                if (!firstInvalidId) {
                    firstInvalidId = q.id;
                }
            } else {
                if (valMsg) {
                    valMsg.classList.remove('show');
                }
            }
        }
    });
    
    // Scroll to first invalid field
    if (!isValid && firstInvalidId) {
        const firstInvalid = document.getElementById(`val-${firstInvalidId}`);
        if (firstInvalid) {
            firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        alert(lang === 'ja' ? 
            'å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„' : 
            'Please complete all required fields');
    }
    
    return isValid;
}

// =====================================================
// NAVIGATION
// =====================================================

function proceedToDetails(lang) {
    console.log('â¡ï¸ Proceeding to details...');
    
    if (!validateStep('reason', lang)) return;
    
    // Track analytics
    trackEvent('cancellation_step1_completed', {
        reason: cancellationState.selectedReason
    });
    
    // Update state
    cancellationState.currentStep = 'details';
    
    // Render questions
    renderCurrentStep();
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function proceedToOfferOrConfirm(lang) {
    console.log('â¡ï¸ Proceeding to offer or confirm...');
    
    if (!validateStep('details', lang)) return;
    
    // Track analytics
    trackEvent('cancellation_step2_completed', {
        reason: cancellationState.selectedReason,
        answers: cancellationState.questionAnswers
    });
    
    // Determine if we should show an offer
    const offerDecision = determineOffer(
        cancellationState.selectedReason,
        cancellationState.questionAnswers,
        lang
    );
    
    if (offerDecision) {
    console.log('âœ¨ Showing retention offer:', offerDecision.type);
    
    cancellationState.currentStep = 'offer';
    cancellationState.offerShown = offerDecision.type;
    cancellationState.offerType = offerDecision.type;
    cancellationState.offerDecision = offerDecision;
    
    renderOffer(lang, offerDecision);
        
        // Track offer shown
        trackEvent('retention_offer_shown', {
            offer_type: offerDecision.type,
            reason: cancellationState.selectedReason
        });
    } else {
        console.log('â†ªï¸ No offer, proceeding to confirmation');
        
        cancellationState.currentStep = 'confirm';
        renderCurrentStep();
    }
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function goBack(lang, from) {
    console.log('â¬…ï¸ Going back from:', from);
    
    if (from === 'details') {
        cancellationState.currentStep = 'reason';
    } else if (from === 'offer') {
        cancellationState.currentStep = 'details';
    } else if (from === 'confirm') {
        if (cancellationState.offerShown) {
            cancellationState.currentStep = 'offer';
        } else {
            cancellationState.currentStep = 'details';
        }
    }
    
    renderCurrentStep();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// =====================================================
// OFFER RENDERING
// =====================================================

function renderOffer(lang, offerDecision) {
    const offer = offerDecision.offer;
    const offerSectionEl = document.getElementById(`${lang}-section-offer`);
    
    if (!offerSectionEl) return;
    
    offerSectionEl.innerHTML = `
        <div class="retention-offer">
            <h3>${offer.title}</h3>
            <p style="font-size: 1.1rem; margin-bottom: 1rem;">${offer.subtitle}</p>
            <p>${offer.description}</p>
            
            <ul class="offer-features">
                ${offer.features.map(feature => `
                    <li><i class="fas fa-check-circle"></i> ${feature}</li>
                `).join('')}
            </ul>
            
            <div class="offer-actions">
                <button class="btn-primary-action" onclick="acceptOffer('${lang}')">
                    ${offer.primaryAction.text}
                </button>
                <button class="btn-secondary-action" onclick="declineOffer('${lang}')">
                    ${offer.secondaryAction.text}
                </button>
            </div>
        </div>
    `;
    
    // Show offer section
    document.getElementById(`${lang}-section-reason`).classList.remove('active');
    document.getElementById(`${lang}-section-details`).classList.remove('active');
    offerSectionEl.classList.add('active');
    document.getElementById(`${lang}-section-confirm`).classList.remove('active');
}

async function acceptOffer(lang) {
    console.log('âœ… Offer accepted');
    
    const offerType = cancellationState.offerType;
    
    // Track analytics
    trackEvent('retention_offer_accepted', {
        offer_type: offerType,
        reason: cancellationState.selectedReason
    });
    
    // Show processing overlay
    showProcessing(lang === 'ja' ? 'å‡¦ç†ä¸­...' : 'Processing...');
    
    try {
        // Determine offer data based on type
        let offerData = {};
        switch(offerType) {
            case 'downgrade':
                offerData = { newPlan: 'A' };
                break;
            case 'discount':
                offerData = { couponCode: 'RETAIN_20PCT_3MO' };
                break;
            case 'pause':
                offerData = { pauseMonths: 2 };
                break;
            case 'consultation':
                offerData = { freeConsultation: true };
                break;
            case 'waitlist':
                offerData = { waitlistType: 'advanced_content' };
                break;
            case 'technical_support':
                offerData = { freeMonth: true, prioritySupport: true };
                break;
            case 'alumni':
                offerData = { alumniDiscount: 50 };
                break;
        }
        
        // Call edge function
        const result = await handleRetentionOffer(offerType, offerData);
        
        hideProcessing();
        
        if (result.success) {
            // Show success message
            alert(lang === 'ja' ? 
                'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼å¤‰æ›´ãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚' :
                'Thank you! Your changes have been applied.');
            
            // Redirect to dashboard
            window.location.href = 'dashboard.html';
        } else {
            throw new Error(result.error || 'Unknown error');
        }
        
    } catch (error) {
        console.error('âŒ Error accepting offer:', error);
        hideProcessing();
        
        alert(lang === 'ja' ?
            'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ã„ãŸã ãã‹ã€ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚' :
            'An error occurred. Please try again or contact support.');
    }
}

function declineOffer(lang) {
    console.log('âŒ Offer declined');
    
    // Track analytics
    trackEvent('retention_offer_declined', {
        offer_type: cancellationState.offerType,
        reason: cancellationState.selectedReason
    });
    
    // Proceed to final confirmation
    cancellationState.currentStep = 'confirm';
    renderCurrentStep();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// =====================================================
// CONFIRMATION RENDERING
// =====================================================

function renderConfirmation(lang) {
    const reason = cancellationState.selectedReason;
    const reasonObj = cancellationReasons[lang].find(r => r.id === reason);
    const plan = cancellationState.userData.currentPlan || 'Standard';
    
    // Update confirmation details
    const planEl = document.getElementById(`${lang}-confirm-plan`);
    const endDateEl = document.getElementById(`${lang}-confirm-end-date`);
    const reasonEl = document.getElementById(`${lang}-confirm-reason`);
    
    if (planEl) planEl.textContent = `Plan ${plan}`;
    if (endDateEl) {
        const endDate = new Date();
        endDate.setMonth(endDate.getMonth() + 1);
        endDateEl.textContent = endDate.toLocaleDateString(lang === 'ja' ? 'ja-JP' : 'en-US');
    }
    if (reasonEl && reasonObj) reasonEl.textContent = reasonObj.title;
    
    // Update loss list based on plan
    const lossListEl = document.getElementById(`${lang}-loss-list`);
    if (lossListEl) {
        const losses = lang === 'ja' ? [
            'æ¯æ—¥ã®LINEç·´ç¿’',
            'ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯',
            'ãƒ“ãƒ‡ã‚ªãƒ¬ãƒƒã‚¹ãƒ³',
            'é€²æ—ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°',
            'å­¦ç¿’ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ'
        ] : [
            'Daily LINE practice',
            'Feedback from native speakers',
            'Video lessons',
            'Progress tracking',
            'Your lesson credits'
        ];
        
        lossListEl.innerHTML = losses.map(loss => `<li>${loss}</li>`).join('');
    }
    
    // Show confirmation section
    document.getElementById(`${lang}-section-reason`).classList.remove('active');
    document.getElementById(`${lang}-section-details`).classList.remove('active');
    document.getElementById(`${lang}-section-offer`).classList.remove('active');
    document.getElementById(`${lang}-section-confirm`).classList.add('active');
}

async function confirmCancellation(lang) {
    console.log('ğŸš¨ Confirming cancellation...');
    
    // Double-check confirmation
    const confirmText = lang === 'ja' ?
        'æœ¬å½“ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚' :
        'Are you sure you want to cancel? This action cannot be undone.';
    
    if (!confirm(confirmText)) {
        return;
    }
    
    // Show processing
    showProcessing(lang === 'ja' ? 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†ä¸­...' : 'Processing cancellation...');
    
    try {
        // Prepare cancellation data
        const cancellationData = {
            reason_category: cancellationState.selectedReason,
            reason_details: cancellationState.questionAnswers,
            satisfaction_rating: cancellationState.universalAnswers.satisfaction_rating || 0,
            would_recommend: cancellationState.universalAnswers.would_recommend || '',
            additional_comments: cancellationState.universalAnswers.what_could_improve || '',
            retention_offer_shown: cancellationState.offerShown,
            retention_offer_result: cancellationState.offerShown ? 'declined' : 'not_shown',
            is_alumni: cancellationState.selectedReason === 'goals_met'
        };
        
        // Call cancellation edge function
        const result = await cancelSubscription(cancellationData);
        
        hideProcessing();
        
        if (result.success) {
            // Track final cancellation
            trackEvent('cancellation_completed', {
                reason: cancellationState.selectedReason,
                had_offer: !!cancellationState.offerShown,
                accepted_offer: false,
                satisfaction: cancellationData.satisfaction_rating,
                would_recommend: cancellationData.would_recommend
            });
            
            // Show success message
            alert(lang === 'ja' ?
                'ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚' :
                'Your subscription has been cancelled. Thank you for being a student.');
            
            // Redirect to home
            window.location.href = 'index.html';
        } else {
            throw new Error(result.error || 'Cancellation failed');
        }
        
    } catch (error) {
        console.error('âŒ Error cancelling subscription:', error);
        hideProcessing();
        
        alert(lang === 'ja' ?
            'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚µãƒãƒ¼ãƒˆã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚' :
            'An error occurred. Please contact support.');
    }
}

// =====================================================
// API/EDGE FUNCTION CALLS
// =====================================================

async function handleRetentionOffer(offerType, offerData) {
    console.log('ğŸ“¡ Calling handle-retention-offer...', { offerType, offerData });
    
    try {
        const { data, error } = await supabase.functions.invoke('handle-retention-offer', {
            body: {
                action: 'accept-offer',
                offerType,
                offerDetails: offerData,
                cancellationData: {
                    reason: cancellationState.selectedReason,
                    details: cancellationState.questionAnswers
                }
            }
        });
        
        if (error) throw error;
        
        return { success: true, data };
        
    } catch (error) {
        console.error('âŒ Edge function error:', error);
        return { success: false, error: error.message };
    }
}

async function cancelSubscription(cancellationData) {
    console.log('ğŸ“¡ Calling cancel-subscription...', cancellationData);
    
    try {
        const { data, error } = await supabase.functions.invoke('cancel-subscription', {
            body: {
                action: 'cancel',
                ...cancellationData
            }
        });
        
        if (error) throw error;
        
        return { success: true, data };
        
    } catch (error) {
        console.error('âŒ Edge function error:', error);
        return { success: false, error: error.message };
    }
}

// =====================================================
// UTILITY FUNCTIONS
// =====================================================

function showProcessing(text) {
    const overlay = document.getElementById('processing-overlay');
    const textEl = document.getElementById('processing-text');
    
    if (overlay) overlay.classList.add('show');
    if (textEl) textEl.textContent = text;
}

function hideProcessing() {
    const overlay = document.getElementById('processing-overlay');
    if (overlay) overlay.classList.remove('show');
}

function updateLanguageDisplay(lang) {
    // Show/hide language sections
    document.getElementById('ja-cancellation').style.display = lang === 'ja' ? 'block' : 'none';
    document.getElementById('en-cancellation').style.display = lang === 'en' ? 'block' : 'none';
}

function trackEvent(eventName, eventData) {
    // Google Analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', eventName, eventData);
    }
    
    // Console log for debugging
    console.log('ğŸ“Š Analytics:', eventName, eventData);
}

// =====================================================
// WINDOW LOAD
// =====================================================

window.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸš€ Cancellation page loaded');
    initCancellationFlow();
});

// Warn before leaving
window.addEventListener('beforeunload', (e) => {
    if (cancellationState.currentStep !== 'reason' && !cancellationState.offerAccepted) {
        e.preventDefault();
        e.returnValue = '';
    }
});

console.log('âœ… Part 2B loaded: Input handlers, navigation, validation, API calls');

    </script>
</body>
</html>
